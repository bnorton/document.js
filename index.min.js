!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.model=t()}}(function(){var t;return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,e,n){t("progenitor.js")();var i=function(t){t&&t()};Adapter=Object.progeny("Adapter",{init:function(t){this.modelClass=t}},{classMethods:{connect:i,clear:i,disconnect:i}}),n=e.exports=Adapter},{"progenitor.js":14}],2:[function(t,e,n){function i(t){return!isNaN(parseFloat(t))&&isFinite(t)}function r(){this.loaded&&(null===this.count?this.RSVP.error.call(this):this.RSVP.success.call(this,this.count))}t("progenitor.js")();var s=function(){};Count=Object.progeny("Count",{init:function(t){this.relation=t,this.count=null,this.loaded=!1,this.RSVP={success:s,error:s}},kept:function(t){this.count=i(t)?t:null,this.loaded=!0,r.call(this)},then:function(t,e){this.RSVP.success=t||s,this.RSVP.error=e||s,r.call(this)}}),n=e.exports=Count},{"progenitor.js":14}],3:[function(t,e,n){var i=function(){},r=[],s=t("extend"),o=t("./adapter");MemoryAdapter=o.progeny("MemoryAdapter",{init:function(){this._data=[]},create:function(t,e){this._data.push(t),r.push(this),e(t)},update:function(t,e,n){var i=0;this.where(t,function(t){i=t.length,t.forEach(function(t){s(t,e)}),n(i||null)})},count:function(t){t(this._data.length)},first:function(t){t(this._data[0]||null)},last:function(t){t(this._data[this._data.length-1]||null)},where:function(t,e){if(!t)return void(e&&e(null));var n=Object.keys(t);n.length||e(this.all()),e(this._data.filter(function(e){var i=!0;return n.forEach(function(n){e[n]!==t[n]&&(i=!1)}),i}))},all:function(){return this._data.slice()},remove:function(t,e){this._data=this._data.filter(function(e){return e._id!==t._id}),e(!0)},clear:function(t){this._data=[],t(!0)}},{classMethods:{clear:function(){r.forEach(function(t){t.clear(i)})}}}),n=e.exports=MemoryAdapter},{"./adapter":1,extend:6}],4:[function(t,e,n){var i=t("json.mustache.js"),r=t("i")(),s=t("mongodb").MongoClient,o=t("./adapter");MongoAdapter=o.progeny("MongoAdapter",{collection:function(){if(this._collection)return this._collection;var t=this["class"].connection;if(!t)throw new Error("MongoDB not connected");return this._collection=t.collection(r.tableize(this.modelClass.className))},create:function(t,e){this.collection().insertOne(t,function(n,i){e(n?null:t)})},update:function(t,e,n){var i=function(t,e){n(t?null:e)};t._id?this.collection().updateOne(t,{$set:e},i):this.collection().updateMany(t,{$set:e},i)},count:function(t){this.collection().count(function(e,n){t(e?null:n)})},first:function(t){this.collection().find({}).limit(1).sort({_id:1}).toArray(function(e,n){t(e?null:n[0]||null)})},last:function(t){this.collection().find({}).limit(1).sort({_id:-1}).toArray(function(e,n){t(e?null:n[0]||null)})},where:function(t,e){return t?void this.collection().find(t).toArray(function(t,n){e(t?null:n)}):void(e&&e(null))},remove:function(t,e){this.collection().deleteMany(t,function(n,i){e(n?null:t)})},clear:function(t){this.collection().remove({},t)}},{classMethods:{connection:null,connect:function(t){var e=this;s.connect(i("mongo").url,function(n,i){if(n)throw console.warn("Error connecting to MongoDB error: ",n,"<---"),new Error("DB connect error",n);e.connection=i,t()})},disconnect:function(t){this.connection.close(),t()}}}),n=e.exports=MongoAdapter},{"./adapter":1,i:8,"json.mustache.js":13,mongodb:void 0}],5:[function(t,e,n){function i(t){return!isNaN(parseFloat(t))&&isFinite(t)}function r(){this.loaded&&(this.RSVP.wasKept?this.RSVP.success.call(this,this.RSVP.wasKept):this.RSVP.error.call(this))}RelationError=Error.progeny("RelationError",{init:function(t){this.name=this.className,this.message=t}});var s=t("extend"),o=function(){};Relation=Object.progeny("Relation",{init:function(t,e){this.modelClass=t,this.adapter=t.adapter,e?this.model=e:this._query={},this.loaded=!1,this.items=null,this.size=null,this.RSVP={success:o,error:o,wasKept:!1}},kept:function(t){this.loaded=!0,this.RSVP.wasKept=t,this.items=this.size=null,Array.isArray(t)?this.items=t:i(t)&&(this.size=t),r.call(this)},then:function(t,e){this.RSVP.success=t||o,this.RSVP.error=e||o,r.call(this)},query:function(){return this._query?s({},this._query):null},count:function(){var t=this,e=new Document.Count(this);return this.adapter.count(function(n){t.loaded=!0,e.kept(n)}),e},find:function(t){var e=this;return this.loaded=!1,this.model?(this.adapter.where({_id:this.model.id},function(t){e.loaded=!0,e.model.kept(Array.isArray(t)?t[0]:t)}),this.model):(this.adapter.where(t,function(t){Array.isArray(t)&&(t=t.map(function(t){return new e.modelClass(t)})),e.kept(t)}),this)},asJSON:function(){return this.items?this.items.map(function(t){return t.asJSON()}):i(this.size)?this.size:null},create:function(t){var e=this;if(this.loaded=!1,!this.model)throw new RelationError("Non-model creates are not supported.");return this.adapter.create(t,function(t){e.loaded=!0,e.model.kept(t)}),this.model},update:function(t){var e=this;return this.loaded=!1,this.model?(this.adapter.update({_id:this.model.id},t,function(t){e.loaded=!0,e.model.kept(t)}),this.model):(this.adapter.update(this._query,t,function(t){e.kept(t)}),this)}}),n=e.exports=Relation},{extend:6}],6:[function(t,e,n){var i,r=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===s.call(t)},a=function(t){"use strict";if(!t||"[object Object]"!==s.call(t))return!1;var e=r.call(t,"constructor"),n=t.constructor&&t.constructor.prototype&&r.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!n)return!1;var o;for(o in t);return o===i||r.call(t,o)};e.exports=function u(){"use strict";var t,e,n,r,s,l,c=arguments[0],f=1,h=arguments.length,d=!1;for("boolean"==typeof c?(d=c,c=arguments[1]||{},f=2):("object"!=typeof c&&"function"!=typeof c||null==c)&&(c={});h>f;++f)if(t=arguments[f],null!=t)for(e in t)n=c[e],r=t[e],c!==r&&(d&&r&&(a(r)||(s=o(r)))?(s?(s=!1,l=n&&o(n)?n:[]):l=n&&a(n)?n:{},c[e]=u(d,l,r)):r!==i&&(c[e]=r));return c}},{}],7:[function(t,e,n){e.exports=function(t){t.plural(/$/,"s"),t.plural(/s$/i,"s"),t.plural(/(ax|test)is$/i,"$1es"),t.plural(/(octop|vir)us$/i,"$1i"),t.plural(/(octop|vir)i$/i,"$1i"),t.plural(/(alias|status)$/i,"$1es"),t.plural(/(bu)s$/i,"$1ses"),t.plural(/(buffal|tomat)o$/i,"$1oes"),t.plural(/([ti])um$/i,"$1a"),t.plural(/([ti])a$/i,"$1a"),t.plural(/sis$/i,"ses"),t.plural(/(?:([^f])fe|([lr])f)$/i,"$1ves"),t.plural(/(hive)$/i,"$1s"),t.plural(/([^aeiouy]|qu)y$/i,"$1ies"),t.plural(/(x|ch|ss|sh)$/i,"$1es"),t.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),t.plural(/([m|l])ouse$/i,"$1ice"),t.plural(/([m|l])ice$/i,"$1ice"),t.plural(/^(ox)$/i,"$1en"),t.plural(/^(oxen)$/i,"$1"),t.plural(/(quiz)$/i,"$1zes"),t.singular(/s$/i,""),t.singular(/(n)ews$/i,"$1ews"),t.singular(/([ti])a$/i,"$1um"),t.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1sis"),t.singular(/(^analy)ses$/i,"$1sis"),t.singular(/([^f])ves$/i,"$1fe"),t.singular(/(hive)s$/i,"$1"),t.singular(/(tive)s$/i,"$1"),t.singular(/([lr])ves$/i,"$1f"),t.singular(/([^aeiouy]|qu)ies$/i,"$1y"),t.singular(/(s)eries$/i,"$1eries"),t.singular(/(m)ovies$/i,"$1ovie"),t.singular(/(x|ch|ss|sh)es$/i,"$1"),t.singular(/([m|l])ice$/i,"$1ouse"),t.singular(/(bus)es$/i,"$1"),t.singular(/(o)es$/i,"$1"),t.singular(/(shoe)s$/i,"$1"),t.singular(/(cris|ax|test)es$/i,"$1is"),t.singular(/(octop|vir)i$/i,"$1us"),t.singular(/(alias|status)es$/i,"$1"),t.singular(/^(ox)en/i,"$1"),t.singular(/(vert|ind)ices$/i,"$1ex"),t.singular(/(matr)ices$/i,"$1ix"),t.singular(/(quiz)zes$/i,"$1"),t.singular(/(database)s$/i,"$1"),t.irregular("child","children"),t.irregular("person","people"),t.irregular("man","men"),t.irregular("child","children"),t.irregular("sex","sexes"),t.irregular("move","moves"),t.irregular("cow","kine"),t.irregular("zombie","zombies"),t.uncountable(["equipment","information","rice","money","species","series","fish","sheep","jeans"])}},{}],8:[function(t,e,n){e.exports=function(e){var n=t("./methods");return e&&t("./native")(n),n}},{"./methods":10,"./native":11}],9:[function(t,e,n){var i=t("./util"),r=function(){return this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[],t("./defaults")(this),this};r.prototype.plural=function(t,e){"string"==typeof t&&(this.uncountables=i.array.del(this.uncountables,t)),this.uncountables=i.array.del(this.uncountables,e),this.plurals.unshift([t,e])},r.prototype.singular=function(t,e){"string"==typeof t&&(this.uncountables=i.array.del(this.uncountables,t)),this.uncountables=i.array.del(this.uncountables,e),this.singulars.unshift([t,e])},r.prototype.irregular=function(t,e){this.uncountables=i.array.del(this.uncountables,t),this.uncountables=i.array.del(this.uncountables,e),t[0].toUpperCase()==e[0].toUpperCase()?(this.plural(new RegExp("("+t[0]+")"+t.slice(1)+"$","i"),"$1"+e.slice(1)),this.plural(new RegExp("("+e[0]+")"+e.slice(1)+"$","i"),"$1"+e.slice(1)),this.singular(new RegExp("("+e[0]+")"+e.slice(1)+"$","i"),"$1"+t.slice(1))):(this.plural(new RegExp(""+t[0].toUpperCase()+t.slice(1)+"$"),e[0].toUpperCase()+e.slice(1)),this.plural(new RegExp(""+t[0].toLowerCase()+t.slice(1)+"$"),e[0].toLowerCase()+e.slice(1)),this.plural(new RegExp(""+e[0].toUpperCase()+e.slice(1)+"$"),e[0].toUpperCase()+e.slice(1)),this.plural(new RegExp(""+e[0].toLowerCase()+e.slice(1)+"$"),e[0].toLowerCase()+e.slice(1)),this.singular(new RegExp(""+e[0].toUpperCase()+e.slice(1)+"$"),t[0].toUpperCase()+t.slice(1)),this.singular(new RegExp(""+e[0].toLowerCase()+e.slice(1)+"$"),t[0].toLowerCase()+t.slice(1)))},r.prototype.human=function(t,e){this.humans.unshift([t,e])},r.prototype.uncountable=function(t){this.uncountables=this.uncountables.concat(t)},r.prototype.clear=function(t){switch(null==t&&(t="all"),t){case"all":this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[];default:this[t]=[]}},r.prototype["default"]=function(){return this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[],t("./defaults")(this),this},e.exports=new r},{"./defaults":7,"./util":12}],10:[function(t,e,n){var i=t("./util"),r=e.exports;r.inflections=t("./inflections"),r.inflect=function(t){t(r.inflections)},r.camelize=function(t,e){var n;return null==e&&(e=!0),n=i.string.gsub(t,/\/(.?)/,function(t){return"."+i.string.upcase(t[1])}),n=i.string.gsub(n,/(?:_)(.)/,function(t){return i.string.upcase(t[1])}),e?i.string.upcase(n):i.string.downcase(n)},r.underscore=function(t){var e;return e=i.string.gsub(t,/\./,"/"),e=i.string.gsub(e,/([A-Z]+)([A-Z][a-z])/,"$1_$2"),e=i.string.gsub(e,/([a-z\d])([A-Z])/,"$1_$2"),e=i.string.gsub(e,/-/,"_"),e.toLowerCase()},r.dasherize=function(t){return i.string.gsub(t,/_/,"-")},r.demodulize=function(t){return i.string.gsub(t,/^.*\./,"")},r.foreign_key=function(t,e){return null==e&&(e=!0),r.underscore(r.demodulize(t))+(e?"_id":"id")},r.ordinalize=function(t){var e;if(t=parseInt(t),11===(e=Math.abs(t)%100)||12===e||13===e)return""+t+"th";switch(Math.abs(t)%10){case 1:return""+t+"st";case 2:return""+t+"nd";case 3:return""+t+"rd";default:return""+t+"th"}},r.uncountability=function(t){return r.inflections.uncountables.some(function(e,n,i){return null!=t.match(new RegExp("(\\b|_)"+e+"$","i"))})},r.pluralize=function(t){var e,n;if(n=t,""===t||r.uncountability(t))return n;for(var s=0;s<r.inflections.plurals.length&&(e=r.inflections.plurals[s],n=i.string.gsub(n,e[0],e[1]),null==t.match(e[0]));s++);return n},r.singularize=function(t){var e,n;if(e=t,""===t||r.uncountability(t))return e;for(var s=0;s<r.inflections.singulars.length&&(n=r.inflections.singulars[s],e=i.string.gsub(e,n[0],n[1]),!t.match(n[0]));s++);return e},r.humanize=function(t){var e,n;n=t;for(var s=0;s<r.inflections.humans.length;s++)e=r.inflections.humans[s],n=i.string.gsub(n,e[0],e[1]);return n=i.string.gsub(n,/_id$/,""),n=i.string.gsub(n,/_/," "),i.string.capitalize(n,!0)},r.titleize=function(t){var e;return e=r.humanize(r.underscore(t)),e=i.string.gsub(e,/[^a-zA-Z:']/," "),i.string.capitalize(e)},r.tableize=function(t){return r.pluralize(r.underscore(t))},r.classify=function(t){return r.camelize(r.singularize(i.string.gsub(t,/.*\./,"")))}},{"./inflections":9,"./util":12}],11:[function(t,e,n){e.exports=function(t){var e=function(t,e){String.prototype.__defineGetter__(t,e)},n=["__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","charAt","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","charCodeAt","indexOf","lastIndexof","length","localeCompare","match","replace","search","slice","split","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimLeft","trimRight","gsub"];Object.keys(t).forEach(function(i){"inflect"!=i&&"inflections"!=i&&(-1!==n.indexOf(i)?console.log("warn: You should not override String.prototype."+i):e(i,function(){return t[i](this)}))})}},{}],12:[function(t,e,n){var i=e.exports={array:{del:function(t,e){var n=t.indexOf(e);return-1!=n?0==n?t.slice(1):t.slice(0,n).concat(t.slice(n+1)):t},first:function(t){return t[0]},last:function(t){return t[t.length-1]}},string:{gsub:function(t,e,n){var r,s,o,a,u,l,c;if(null==e||null==n)return i.string.value(t);for(l="",c=t;c.length>0;)if(s=c.match(e)){if(l+=c.slice(0,s.index),"function"==typeof n)s[1]=s[1]||s[0],l+=n(s);else if(n.match(/\$[1-9]/)){for(a=s,o=i.array.del(s,void 0);o!==a;)a=o,o=i.array.del(o,void 0);for(s[1]=s[1]||s[0],u=n,r=1;9>=r;r++)o[r]&&(u=i.string.gsub(u,new RegExp("\\$"+r),o[r]));l+=u}else l+=n;c=c.slice(s.index+s[0].length)}else l+=c,c="";return l},upcase:function(t){var e=i.string.gsub(t,/_([a-z])/,function(t){return"_"+t[1].toUpperCase()});return e=i.string.gsub(e,/\/([a-z])/,function(t){return"/"+t[1].toUpperCase()}),e[0].toUpperCase()+e.substr(1)},capitalize:function(t,e){var n=t.toLowerCase();return e||(n=i.string.gsub(n,/\s([a-z])/,function(t){return" "+t[1].toUpperCase()})),n[0].toUpperCase()+n.substr(1)},downcase:function(t){var e=i.string.gsub(t,/_([A-Z])/,function(t){return"_"+t[1].toLowerCase()});return e=i.string.gsub(e,/\/([A-Z])/,function(t){return"/"+t[1].toLowerCase()}),e[0].toLowerCase()+e.substr(1)},value:function(t){return t.substr(0)}}}},{}],13:[function(t,e,n){(function(i){var r=t("fs"),s={};json=function(t,e){e||(e=i.env.NODE_ENV);var n=t+":"+e;if(s[n])return s[n];for(var o,a,u=JSON.parse(r.readFileSync(i.cwd()+"/config/"+t+".json"))[e],l=Object.keys(u),c=0;c<l.length;++c)a=l[c],o=u[a],"string"==typeof o&&(u[a]=o.replace(/\{\{(\w+)\}\}/g,function(t,e,n){return u[e]||t}));return s[n]=u},n=e.exports=json}).call(this,t("_process"))},{_process:16,fs:15}],14:[function(e,n,i){(function(r){!function(e){if("object"==typeof i&&"undefined"!=typeof n)n.exports=e();else if("function"==typeof t&&t.amd)t([],e);else{var s;s="undefined"!=typeof window?window:"undefined"!=typeof r?r:"undefined"!=typeof self?self:this,s.progenitor=e()}}(function(){return function t(n,i,r){function s(a,u){if(!i[a]){if(!n[a]){var l="function"==typeof e&&e;if(!u&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=i[a]={exports:{}};n[a][0].call(f.exports,function(t){var e=n[a][1][t];return s(e?e:t)},f,f.exports,t,n,i,r)}return i[a].exports}for(var o="function"==typeof e&&e,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(t,e,n){var i,r=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===s.call(t)},a=function(t){"use strict";if(!t||"[object Object]"!==s.call(t))return!1;var e=r.call(t,"constructor"),n=t.constructor&&t.constructor.prototype&&r.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!n)return!1;var o;for(o in t);return o===i||r.call(t,o)};e.exports=function u(){"use strict";var t,e,n,r,s,l,c=arguments[0],f=1,h=arguments.length,d=!1;for("boolean"==typeof c?(d=c,c=arguments[1]||{},f=2):("object"!=typeof c&&"function"!=typeof c||null==c)&&(c={});h>f;++f)if(t=arguments[f],null!=t)for(e in t)n=c[e],r=t[e],c!==r&&(d&&r&&(a(r)||(s=o(r)))?(s?(s=!1,l=n&&o(n)?n:[]):l=n&&a(n)?n:{},c[e]=u(d,l,r)):r!==i&&(c[e]=r));return c}},{}],2:[function(t,e,n){var i=function(){},r=t("extend"),s=function(t){return t.classMethods||(t.classMethods={}),t.classMethods.inherited||(t.classMethods.inherited=i),t.instanceMethods||(t.instanceMethods={}),t.instanceMethods.init||(t.instanceMethods.init=i),function(e,n,o){n=("function"==typeof n?n():n)||{},o=("function"==typeof o?o():o)||{},o.classMethods||(o.classMethods={});var a=function(e){"prototype-definition"!==e&&(t.instanceMethods.init.apply(this,arguments),d.init.apply(this,arguments))},u=function(e){return t.classMethods[e]&&t.classMethods[e].apply(this,Array.prototype.slice.call(arguments,1))},l={"class":t,className:e,"super":u,progeny:s(a)},c=r({},t.classMethods,l,o.classMethods);r(a,a.classMethods=c);var f=function(e){return t.instanceMethods[e]&&t.instanceMethods[e].apply(this,Array.prototype.slice.call(arguments,1))},h={constructor:t,"class":a,className:e,"super":f,init:i},d=r({},t.instanceMethods,h,n);return a.prototype=new t("prototype-definition"),r(a.prototype,a.instanceMethods=d),t.classMethods.inherited.apply(t,[a]),a}};n=e.exports=function(){Object.progeny||(Object.progeny=s(Object)),Error.progeny||(Error.progeny=s(Object))}},{extend:1}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{extend:6}],15:[function(t,e,n){},{}],16:[function(t,e,n){function i(){c=!1,a.length?l=a.concat(l):f=-1,l.length&&r()}function r(){if(!c){var t=setTimeout(i);c=!0;for(var e=l.length;e;){for(a=l,l=[];++f<e;)a[f].run();f=-1,e=l.length}a=null,c=!1,clearTimeout(t)}}function s(t,e){this.fun=t,this.array=e}function o(){}var a,u=e.exports={},l=[],c=!1,f=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new s(t,e)),1!==l.length||c||setTimeout(r,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=o,u.addListener=o,u.once=o,u.off=o,u.removeListener=o,u.removeAllListeners=o,u.emit=o,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],17:[function(t,e,n){(function(i){function r(t){var e=t.id||t._id;this.persisted=!!e,e?u.isValid(e)?this.id=u(e):"ObjectID"===e._bsontype?this.id=e:this.id=e.toString():null===e?this.id=null:this.id=u(),this._data=a({_id:this.id},o(t,["id","_id"])),this._changes={}}function s(t){var e=new this({_id:null});return this.adapter[t].call(this.adapter,function(t){e.kept(t)}),e}function o(t,e){var n={};for(var i in t)-1==e.indexOf(i)&&(n[i]=t[i]);return n}t("progenitor.js")();var a=t("extend"),u=t("mongodb").ObjectID,l=t("i")(),c="undefined"==typeof window||"test"===i.env.NODE_ENV,f=t(c?"./memory_adapter":"./mongo_adapter"),h=function(){};Document=Object.progeny("Document",{init:function(t,e){r.call(this,t),this.relation=e,this.RSVP={success:h,error:h},this.loaded=!1},isValid:function(){var t,e,n=!0,i=this["class"].validate||{},r=i.presence||[],s=i.format||{},o=Object.keys(s),a=i.custom||[];for(t=0;t<r.length;++t)if(!this.get(r[t])){n=!1;break}if(!n)return!1;for(t=0;t<o.length;++t)if(e=o[t],!s[e].test(this.get(e))){n=!1;break}for(t=0;t<a.length;++t)if(!a[t].call(this)){n=!1;break}return n},get:function(t){if("id"==t)return this.id;if(this["class"].belongsTo.indexOf(t)>=0){var e=this.get(l.foreign_key(t));return e&&Document[l.classify(t)].find(e)}return this["class"].namedFields[t]?this._data[t]||null:void 0},set:function(){var t,e,n,i=arguments[0],r=2==arguments.length,s={};if(arguments[0]){r&&(i={},i[arguments[0]]=arguments[1]);for(t in i){var o=this["class"].belongsTo.indexOf(t)>=0;if(o){var a=l.foreign_key(t);i[a]=i[t].id,t=a}(o||this["class"].namedFields[t])&&((e=this.get(t))!=(n=i[t])&&(this._changes[t]=[e,n]),"_id"===t&&(this.id=n),this._data[t]=s[t]=n)}return r?s[arguments[0]]:s}},changedAttributes:function(){return a({},this._changes)},save:function(){var t=this,e={},n=!this.isValid(),i=!Object.keys(this.changedAttributes()).length;return n||i&&this.persisted?(this.loaded=!0,this):(this.loaded=!1,this.relation=new Document.Relation(this["class"],this),this.persisted?(Object.keys(this._changes).forEach(function(n){e[n]=t.get(n)}),this.relation.update(e)):((this["class"].beforeCreate||[]).forEach(function(e){e.call(t)}),this.relation.create(a({},this._data))))},update:function(){return this.set.apply(this,arguments),this.save()},destroy:function(){var t=this;return this.loaded=!1,this["class"].adapter.remove({_id:this.id},function(e){t.loaded=!0,t.kept(t.isDestroyed=!!e)}),this},kept:function(t){this.set(t),this.loaded=!0,(this.RSVP.wasKept=!!t)?(this._changes={},this.persisted=!0,this.RSVP.success(this)):this.RSVP.error()},then:function(t,e){this.RSVP.success=t||h,this.RSVP.error=e||h,this.loaded&&(this.RSVP.wasKept?this.RSVP.success(this):this.RSVP.error())},asJSON:function(){for(var t,e={id:this.id.toString(),createdAt:this.get("createdAt"),updatedAt:this.get("updatedAt")},n=0;n<this["class"].allow.length;++n)if(t=this["class"].allow[n],/(.+)_id$/.test(t)){var i=this.get(t);e[t.slice(0,-3)]={id:i?i.toString():i}}else e[t]=this.get(t);return e}},{classMethods:{namedFields:null,shortFields:null,inherited:function(t){var e;this[t.className]=t,t.fields||(t.fields={}),t.belongsTo||(t.belongsTo=[]),t.adapter=new f(t),t.fields.ObjectID=a({_id:"_id"},t.fields.ObjectID),t.fields.Date=a({createdAt:"cT",updatedAt:"uT"},t.fields.Date),t.namedFields={},t.shortFields={},t.belongsTo.forEach(function(e){t.fields.ObjectID[l.foreign_key(e)]=e.slice(0,1)+"_id"});for(var n in t.fields)for(var i in e=t.fields[n])t.namedFields[i]=e[i],t.shortFields[e[i]]=i},find:function(t){var e;if(!t||"string"!=typeof t&&"ObjectID"!==t._bsontype)return new Document.Relation(this).find(t);this.loaded=!1,t=u.isValid(t)?u(t):t;var n=new Document.Relation(this,e=new this({_id:t}));return(e.relation=n).find()},count:function(){return new Document.Relation(this).count()},first:function(){return s.call(this,"first")},last:function(){return s.call(this,"last")}}}),a(Document,{Relation:t("./relation"),Count:t("./count"),Adapter:f}),n=e.exports=Document}).call(this,t("_process"))},{"./count":2,"./memory_adapter":3,"./mongo_adapter":4,"./relation":5,_process:16,extend:6,i:8,mongodb:void 0,"progenitor.js":14}]},{},[17])(17)});