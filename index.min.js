!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.model=t()}}(function(){var t;return function n(t,e,r){function i(o,u){if(!e[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=e[o]={exports:{}};t[o][0].call(l.exports,function(n){var e=t[o][1][n];return i(e?e:n)},l,l.exports,n,t,e,r)}return e[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,n,e){t("progenitor.js")();var r=function(t){t&&t()};Adapter=Object.progeny("Adapter",{init:function(t){this.modelClass=t}},{classMethods:{connect:r,clear:r,disconnect:r}}),e=n.exports=Adapter},{"progenitor.js":17}],2:[function(t,n,e){function r(t){return!isNaN(parseFloat(t))&&isFinite(t)}function i(){this.loaded&&(null===this.count?this.RSVP.error.call(this):this.RSVP.success.call(this,this.count))}t("progenitor.js")();var s=function(){};Count=Object.progeny("Count",{init:function(t){this.relation=t,this.count=null,this.loaded=!1,this.RSVP={success:s,error:s}},kept:function(t){this.count=r(t)?t:null,this.loaded=!0,i.call(this)},then:function(t,n){this.RSVP.success=t||s,this.RSVP.error=n||s,i.call(this)}}),e=n.exports=Count},{"progenitor.js":17}],3:[function(t,n,e){var r=function(){},i=[],s=t("extend"),o=t("base-62.js"),u=t("./adapter");MemoryAdapter=u.progeny("MemoryAdapter",{init:function(){this._data=[]},create:function(t,n){this._data.push(t),i.push(this),n(t)},update:function(t,n,e){var r=0;this.where(t,function(t){r=t.length,t.forEach(function(t){s(t,n)}),e(r||null)})},count:function(t){t(this._data.length)},first:function(t){t(this._data[0]||null)},last:function(t){t(this._data[this._data.length-1]||null)},where:function(t,n){if(!t)return void(n&&n(null));var e=Object.keys(t);e.length||n(this.all()),n(this._data.filter(function(n){var r=!0;return e.forEach(function(e){n[e]!==t[e]&&(r=!1)}),r}))},all:function(){return this._data.slice()},remove:function(t,n){this._data=this._data.filter(function(n){return n._id!==t._id}),n(!0)},clear:function(t){this._data=[],t(!0)}},{classMethods:{clear:function(){i.forEach(function(t){t.clear(r)})},ids:{isValid:function(t){return!!t},next:function(t){return t||o.token()}}}}),e=n.exports=MemoryAdapter},{"./adapter":1,"base-62.js":6,extend:9}],4:[function(t,n,e){var r=t("json.mustache.js"),i=t("i")(),s=function(){return t("mongodb").ObjectID},o=t("./adapter");MongoAdapter=o.progeny("MongoAdapter",{collection:function(){if(this._collection)return this._collection;var t=this["class"].connection;if(!t)throw new Error("MongoDB not connected");return this._collection=t.collection(i.tableize(this.modelClass.className))},create:function(t,n){this.collection().insertOne(t,function(e,r){n(e?null:t)})},update:function(t,n,e){var r=function(t,n){e(t?null:n)};t._id?this.collection().updateOne(t,{$set:n},r):this.collection().updateMany(t,{$set:n},r)},count:function(t){this.collection().count(function(n,e){t(n?null:e)})},first:function(t){this.collection().find({}).limit(1).sort({_id:1}).toArray(function(n,e){t(n?null:e[0]||null)})},last:function(t){this.collection().find({}).limit(1).sort({_id:-1}).toArray(function(n,e){t(n?null:e[0]||null)})},where:function(t,n){return t?void this.collection().find(t).toArray(function(t,e){n(t?null:e)}):void(n&&n(null))},remove:function(t,n){this.collection().deleteMany(t,function(e,r){n(e?null:t)})},clear:function(t){this.collection().remove({},t)}},{classMethods:{connection:null,connect:function(n){var e=this,i=r("mongo").url;t("mongodb").MongoClient.connect(i,function(t,r){if(t)throw console.warn("Error connecting to MongoDB error: ",t,"<---"),new Error("DB connect error",t);e.connection=r,n()})},disconnect:function(t){this.connection.close(),t()},ids:{isValid:function(t){return s().isValid(t)},next:function(t){return s()(t)}}}}),e=n.exports=MongoAdapter},{"./adapter":1,i:11,"json.mustache.js":16,mongodb:void 0}],5:[function(t,n,e){function r(t){return!isNaN(parseFloat(t))&&isFinite(t)}function i(){this.loaded&&(this.RSVP.wasKept?this.RSVP.success.call(this,this.RSVP.wasKept):this.RSVP.error.call(this))}RelationError=Error.progeny("RelationError",{init:function(t){this.name=this.className,this.message=t}});var s=t("extend"),o=function(){};Relation=Object.progeny("Relation",{init:function(t,n){this.modelClass=t,n?this.model=n:this._query={},this.loaded=!1,this.items=null,this.size=null,this.RSVP={success:o,error:o,wasKept:!1}},kept:function(t){this.loaded=!0,this.RSVP.wasKept=t,this.items=this.size=null,Array.isArray(t)?this.items=t:r(t)&&(this.size=t),i.call(this)},then:function(t,n){this.RSVP.success=t||o,this.RSVP.error=n||o,i.call(this)},query:function(){return this._query?s({},this._query):null},count:function(){var t=this,n=new Document.Count(this);return this.modelClass.adapter().count(function(e){t.loaded=!0,n.kept(e)}),n},find:function(t){var n=this;if(this.loaded=!1,this.model)return this.modelClass.adapter().where({_id:this.model.id},function(t){n.loaded=!0,t=Array.isArray(t)?n.model["class"].shortToLong(t[0]):t,n.model.kept(t)}),this.model;var e=this.modelClass;return t=e.longToShort(t),this.modelClass.adapter().where(t,function(t){Array.isArray(t)&&(t=t.map(function(t){var n=new e({_id:null});return n.kept(e.shortToLong(t)),n})),n.kept(t)}),this},asJSON:function(){return this.items?this.items.map(function(t){return t.asJSON()}):r(this.size)?this.size:null},create:function(t){var n=this;if(this.loaded=!1,!this.model)throw new RelationError("Non-model creates are not supported.");return t=s(t,{createdAt:new Date,updatedAt:new Date}),t=this.modelClass.longToShort(t),this.modelClass.adapter().create(t,function(t){n.loaded=!0,t=n.model["class"].shortToLong(t),n.model.kept(t)}),this.model},update:function(t){var n=this;return this.loaded=!1,t=s(t,{updatedAt:new Date}),t=this.modelClass.longToShort(t),this.model?(this.modelClass.adapter().update({_id:this.model.id},t,function(t){n.loaded=!0,n.model.kept(t)}),this.model):(this.modelClass.adapter().update(this._query,t,function(t){n.kept(t)}),this)}}),e=n.exports=Relation},{extend:9}],6:[function(n,e,r){(function(i){!function(n){if("object"==typeof r&&"undefined"!=typeof e)e.exports=n();else if("function"==typeof t&&t.amd)t([],n);else{var s;s="undefined"!=typeof window?window:"undefined"!=typeof i?i:"undefined"!=typeof self?self:this,s.base62=n()}}(function(){var t;return function e(t,r,i){function s(u,a){if(!r[u]){if(!t[u]){var c="function"==typeof n&&n;if(!a&&c)return c(u,!0);if(o)return o(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[u]={exports:{}};t[u][0].call(f.exports,function(n){var e=t[u][1][n];return s(e?e:n)},f,f.exports,e,t,r,i)}return r[u].exports}for(var o="function"==typeof n&&n,u=0;u<i.length;u++)s(i[u]);return s}({1:[function(n,e,r){!function(n){"use strict";function r(){function t(n){var e=this;return e instanceof t?(n instanceof t?(e.s=n.s,e.e=n.e,e.c=n.c.slice()):s(e,n),void(e.constructor=t)):void 0===n?r():new t(n)}return t.prototype=g,t.DP=c,t.RM=l,t}function i(t,n,e){var r=t.constructor,i=n-(t=new r(t)).e,s=t.c;for(s.length>++n&&o(t,i,r.RM),s[0]?e?i=n:(s=t.c,i=t.e+i+1):++i;s.length<i;s.push(0));return i=t.e,1===e||e&&(i>=n||d>=i)?(t.s<0&&s[0]?"-":"")+(s.length>1?s[0]+"."+s.join("").slice(1):s[0])+(0>i?"e":"e+")+i:t.toString()}function s(t,n){var e,r,i;for(0===n&&0>1/n?n="-0":m.test(n+="")||u(NaN),t.s="-"==n.charAt(0)?(n=n.slice(1),-1):1,(e=n.indexOf("."))>-1&&(n=n.replace(".","")),(r=n.search(/e/i))>0?(0>e&&(e=r),e+=+n.slice(r+1),n=n.substring(0,r)):0>e&&(e=n.length),r=0;"0"==n.charAt(r);r++);if(r==(i=n.length))t.c=[t.e=0];else{for(;"0"==n.charAt(--i););for(t.e=e-r-1,t.c=[],e=0;i>=r;t.c[e++]=+n.charAt(r++));}return t}function o(t,n,e,r){var i,s=t.c,o=t.e+n+1;if(1===e?r=s[o]>=5:2===e?r=s[o]>5||5==s[o]&&(r||0>o||s[o+1]!==i||1&s[o-1]):3===e?r=r||s[o]!==i||0>o:(r=!1,0!==e&&u("!Big.RM!")),1>o||!s[0])r?(t.e=-n,t.c=[1]):t.c=[t.e=0];else{if(s.length=o--,r)for(;++s[o]>9;)s[o]=0,o--||(++t.e,s.unshift(1));for(o=s.length;!s[--o];s.pop());}return t}function u(t){var n=new Error(t);throw n.name="BigError",n}var a,c=20,l=1,f=1e6,h=1e6,d=-7,p=21,g={},m=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;g.abs=function(){var t=new this.constructor(this);return t.s=1,t},g.cmp=function(t){var n,e=this,r=e.c,i=(t=new e.constructor(t)).c,s=e.s,o=t.s,u=e.e,a=t.e;if(!r[0]||!i[0])return r[0]?s:i[0]?-o:0;if(s!=o)return s;if(n=0>s,u!=a)return u>a^n?1:-1;for(s=-1,o=(u=r.length)<(a=i.length)?u:a;++s<o;)if(r[s]!=i[s])return r[s]>i[s]^n?1:-1;return u==a?0:u>a^n?1:-1},g.div=function(t){var n=this,e=n.constructor,r=n.c,i=(t=new e(t)).c,s=n.s==t.s?1:-1,a=e.DP;if((a!==~~a||0>a||a>f)&&u("!Big.DP!"),!r[0]||!i[0])return r[0]==i[0]&&u(NaN),i[0]||u(s/0),new e(0*s);var c,l,h,d,p,g,m=i.slice(),v=c=i.length,y=r.length,w=r.slice(0,c),b=w.length,x=t,$=x.c=[],_=0,A=a+(x.e=n.e-t.e)+1;for(x.s=s,s=0>A?0:A,m.unshift(0);b++<c;w.push(0));do{for(h=0;10>h;h++){if(c!=(b=w.length))d=c>b?1:-1;else for(p=-1,d=0;++p<c;)if(i[p]!=w[p]){d=i[p]>w[p]?1:-1;break}if(!(0>d))break;for(l=b==c?i:m;b;){if(w[--b]<l[b]){for(p=b;p&&!w[--p];w[p]=9);--w[p],w[b]+=10}w[b]-=l[b]}for(;!w[0];w.shift());}$[_++]=d?h:++h,w[0]&&d?w[b]=r[v]||0:w=[r[v]]}while((v++<y||w[0]!==g)&&s--);return $[0]||1==_||($.shift(),x.e--),_>A&&o(x,a,e.RM,w[0]!==g),x},g.eq=function(t){return!this.cmp(t)},g.gt=function(t){return this.cmp(t)>0},g.gte=function(t){return this.cmp(t)>-1},g.lt=function(t){return this.cmp(t)<0},g.lte=function(t){return this.cmp(t)<1},g.sub=g.minus=function(t){var n,e,r,i,s=this,o=s.constructor,u=s.s,a=(t=new o(t)).s;if(u!=a)return t.s=-a,s.plus(t);var c=s.c.slice(),l=s.e,f=t.c,h=t.e;if(!c[0]||!f[0])return f[0]?(t.s=-a,t):new o(c[0]?s:0);if(u=l-h){for((i=0>u)?(u=-u,r=c):(h=l,r=f),r.reverse(),a=u;a--;r.push(0));r.reverse()}else for(e=((i=c.length<f.length)?c:f).length,u=a=0;e>a;a++)if(c[a]!=f[a]){i=c[a]<f[a];break}if(i&&(r=c,c=f,f=r,t.s=-t.s),(a=(e=f.length)-(n=c.length))>0)for(;a--;c[n++]=0);for(a=n;e>u;){if(c[--e]<f[e]){for(n=e;n&&!c[--n];c[n]=9);--c[n],c[e]+=10}c[e]-=f[e]}for(;0===c[--a];c.pop());for(;0===c[0];)c.shift(),--h;return c[0]||(t.s=1,c=[h=0]),t.c=c,t.e=h,t},g.mod=function(t){var n,e=this,r=e.constructor,i=e.s,s=(t=new r(t)).s;return t.c[0]||u(NaN),e.s=t.s=1,n=1==t.cmp(e),e.s=i,t.s=s,n?new r(e):(i=r.DP,s=r.RM,r.DP=r.RM=0,e=e.div(t),r.DP=i,r.RM=s,this.minus(e.times(t)))},g.add=g.plus=function(t){var n,e=this,r=e.constructor,i=e.s,s=(t=new r(t)).s;if(i!=s)return t.s=-s,e.minus(t);var o=e.e,u=e.c,a=t.e,c=t.c;if(!u[0]||!c[0])return c[0]?t:new r(u[0]?e:0*i);if(u=u.slice(),i=o-a){for(i>0?(a=o,n=c):(i=-i,n=u),n.reverse();i--;n.push(0));n.reverse()}for(u.length-c.length<0&&(n=c,c=u,u=n),i=c.length,s=0;i;)s=(u[--i]=u[i]+c[i]+s)/10|0,u[i]%=10;for(s&&(u.unshift(s),++a),i=u.length;0===u[--i];u.pop());return t.c=u,t.e=a,t},g.pow=function(t){var n=this,e=new n.constructor(1),r=e,i=0>t;for((t!==~~t||-h>t||t>h)&&u("!pow!"),t=i?-t:t;1&t&&(r=r.times(n)),t>>=1,t;)n=n.times(n);return i?e.div(r):r},g.round=function(t,n){var e=this,r=e.constructor;return null==t?t=0:(t!==~~t||0>t||t>f)&&u("!round!"),o(e=new r(e),t,null==n?r.RM:n),e},g.sqrt=function(){var t,n,e,r=this,i=r.constructor,s=r.c,a=r.s,c=r.e,l=new i("0.5");if(!s[0])return new i(r);0>a&&u(NaN),a=Math.sqrt(r.toString()),0===a||a===1/0?(t=s.join(""),t.length+c&1||(t+="0"),n=new i(Math.sqrt(t).toString()),n.e=((c+1)/2|0)-(0>c||1&c)):n=new i(a.toString()),a=n.e+(i.DP+=4);do e=n,n=l.times(e.plus(r.div(e)));while(e.c.slice(0,a).join("")!==n.c.slice(0,a).join(""));return o(n,i.DP-=4,i.RM),n},g.mul=g.times=function(t){var n,e=this,r=e.constructor,i=e.c,s=(t=new r(t)).c,o=i.length,u=s.length,a=e.e,c=t.e;if(t.s=e.s==t.s?1:-1,!i[0]||!s[0])return new r(0*t.s);for(t.e=a+c,u>o&&(n=i,i=s,s=n,c=o,o=u,u=c),n=new Array(c=o+u);c--;n[c]=0);for(a=u;a--;){for(u=0,c=o+a;c>a;)u=n[c]+s[a]*i[c-a-1]+u,n[c--]=u%10,u=u/10|0;n[c]=(n[c]+u)%10}for(u&&++t.e,n[0]||n.shift(),a=n.length;!n[--a];n.pop());return t.c=n,t},g.toString=g.valueOf=g.toJSON=function(){var t=this,n=t.e,e=t.c.join(""),r=e.length;if(d>=n||n>=p)e=e.charAt(0)+(r>1?"."+e.slice(1):"")+(0>n?"e":"e+")+n;else if(0>n){for(;++n;e="0"+e);e="0."+e}else if(n>0)if(++n>r)for(n-=r;n--;e+="0");else r>n&&(e=e.slice(0,n)+"."+e.slice(n));else r>1&&(e=e.charAt(0)+"."+e.slice(1));return t.s<0&&t.c[0]?"-"+e:e},g.toExponential=function(t){return null==t?t=this.c.length-1:(t!==~~t||0>t||t>f)&&u("!toExp!"),i(this,t,1)},g.toFixed=function(t){var n,e=this,r=d,s=p;return d=-(p=1/0),null==t?n=e.toString():t===~~t&&t>=0&&f>=t&&(n=i(e,e.e+t),e.s<0&&e.c[0]&&n.indexOf("-")<0&&(n="-"+n)),d=r,p=s,n||u("!toFix!"),n},g.toPrecision=function(t){return null==t?this.toString():((t!==~~t||1>t||t>f)&&u("!toPre!"),i(this,t-1,2))},a=r(),"function"==typeof t&&t.amd?t(function(){return a}):"undefined"!=typeof e&&e.exports?e.exports=a:n.Big=a}(this)},{}],2:[function(t,n,e){randomInt=function(t){if((void 0===t||null===t)&&(t={}),(void 0===t.min||null===t)&&(t.min=0),(void 0===t.max||null===t)&&(t.max=4294967295),t.min>t.max){var n=t.min;t.min=t.max,t.max=n}return Math.floor(Math.random()*(t.max-t.min)+t.min)},randomFloat=function(t){return(void 0===t||null===t)&&(t={}),(void 0===t.min||null===t)&&(t.min=0),(void 0===t.max||null===t)&&(t.max=1),Math.random()*(t.max-t.min)+t.min},randomString=function(t){(void 0===t||null===t)&&(t={}),(void 0===t.length||null===t.length)&&(t.length=20),(void 0===t.set||null===t.set)&&(t.set="alphanum");var n;switch(t.set){case"alpha":n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";break;case"alphanum":n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";break;case"num":n="0123456789";break;case"hex":n="0123456789ABCDEF";break;case"custom":if(void 0===t.custom||null===t.custom)return console.error("can't generate a random string with custom set of characters if options.custom is null or undefined"),"";n=t.custom}for(var e="",r=0;r<t.length;r++){var i=randomInt({min:0,max:n.length});e+=n[i]}return e},n.exports.randomInt=randomInt,n.exports.randomFloat=randomFloat,n.exports.randomString=randomString},{}],3:[function(t,n,e){function r(){return Base62.encode(f())}function i(t){var n=c(t,10,16);return n?n:null}function s(t){return c(t.toString().toLowerCase(),16,10)}function o(t,n,e){for(var r=[],i=Math.max(t.length,n.length),s=0,o=0;i>o||s;){var u=o<t.length?t[o]:0,a=o<n.length?n[o]:0,c=s+u+a;r.push(c%e),s=Math.floor(c/e),o++}return r}function u(t,n,e){if(0>t)return null;if(0==t)return[];for(var r=[],i=n;;){if(1&t&&(r=o(r,i,e)),t>>=1,0===t)break;i=o(i,i,e)}return r}function a(t,n){for(var e=t.split(""),r=[],i=e.length-1;i>=0;i--){var s=parseInt(e[i],n);if(isNaN(s))return null;r.push(s)}return r}function c(t,n,e){var r=a(t,n);if(null===r)return null;for(var i=[],s=[1],c=0;c<r.length;c++)r[c]&&(i=o(i,u(r[c],s,e),e)),s=u(n,s,e);for(var l="",c=i.length-1;c>=0;c--)l+=i[c].toString(e);return l}var l=t("big.js"),f=t("random.js").randomInt,h="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";Base62={encode:function(t){var n=t;t=t.toString();try{l(t)}catch(e){console.log("Big init error on ",n,t)}var r=l(t),i="";if("0"==t)return"0";for(;r.gt(0);)i=h[r.mod(62).toFixed()]+i,r=l(r.div(62).toFixed(2).split(".")[0]);return i},decode:function(t){t=t.toString();var n=l(0),e=l(62),r=t.split("").reverse();return r.forEach(function(t,r){n=n.plus(e.pow(r).times(h.indexOf(t)))}),n.toFixed()},encodeHex:function(t){return Base62.encode(s(t.toString()))},decodeHex:function(t){return i(Base62.decode(t))},token:function(){return r()+r()+r()+r()+r()}},e=n.exports=Base62},{"big.js":1,"random.js":2}]},{},[3])(3)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"big.js":7,"random.js":8}],7:[function(n,e,r){!function(n){"use strict";function r(){function t(n){var e=this;return e instanceof t?(n instanceof t?(e.s=n.s,e.e=n.e,e.c=n.c.slice()):s(e,n),void(e.constructor=t)):void 0===n?r():new t(n)}return t.prototype=g,t.DP=c,t.RM=l,t}function i(t,n,e){var r=t.constructor,i=n-(t=new r(t)).e,s=t.c;for(s.length>++n&&o(t,i,r.RM),s[0]?e?i=n:(s=t.c,i=t.e+i+1):++i;s.length<i;s.push(0));return i=t.e,1===e||e&&(i>=n||d>=i)?(t.s<0&&s[0]?"-":"")+(s.length>1?s[0]+"."+s.join("").slice(1):s[0])+(0>i?"e":"e+")+i:t.toString()}function s(t,n){var e,r,i;for(0===n&&0>1/n?n="-0":m.test(n+="")||u(NaN),t.s="-"==n.charAt(0)?(n=n.slice(1),-1):1,(e=n.indexOf("."))>-1&&(n=n.replace(".","")),(r=n.search(/e/i))>0?(0>e&&(e=r),e+=+n.slice(r+1),n=n.substring(0,r)):0>e&&(e=n.length),r=0;"0"==n.charAt(r);r++);if(r==(i=n.length))t.c=[t.e=0];else{for(;"0"==n.charAt(--i););for(t.e=e-r-1,t.c=[],e=0;i>=r;t.c[e++]=+n.charAt(r++));}return t}function o(t,n,e,r){var i,s=t.c,o=t.e+n+1;if(1===e?r=s[o]>=5:2===e?r=s[o]>5||5==s[o]&&(r||0>o||s[o+1]!==i||1&s[o-1]):3===e?r=r||s[o]!==i||0>o:(r=!1,0!==e&&u("!Big.RM!")),1>o||!s[0])r?(t.e=-n,t.c=[1]):t.c=[t.e=0];else{if(s.length=o--,r)for(;++s[o]>9;)s[o]=0,o--||(++t.e,s.unshift(1));for(o=s.length;!s[--o];s.pop());}return t}function u(t){var n=new Error(t);throw n.name="BigError",n}var a,c=20,l=1,f=1e6,h=1e6,d=-7,p=21,g={},m=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;g.abs=function(){var t=new this.constructor(this);return t.s=1,t},g.cmp=function(t){var n,e=this,r=e.c,i=(t=new e.constructor(t)).c,s=e.s,o=t.s,u=e.e,a=t.e;if(!r[0]||!i[0])return r[0]?s:i[0]?-o:0;if(s!=o)return s;if(n=0>s,u!=a)return u>a^n?1:-1;for(s=-1,o=(u=r.length)<(a=i.length)?u:a;++s<o;)if(r[s]!=i[s])return r[s]>i[s]^n?1:-1;return u==a?0:u>a^n?1:-1},g.div=function(t){var n=this,e=n.constructor,r=n.c,i=(t=new e(t)).c,s=n.s==t.s?1:-1,a=e.DP;if((a!==~~a||0>a||a>f)&&u("!Big.DP!"),!r[0]||!i[0])return r[0]==i[0]&&u(NaN),i[0]||u(s/0),new e(0*s);var c,l,h,d,p,g,m=i.slice(),v=c=i.length,y=r.length,w=r.slice(0,c),b=w.length,x=t,$=x.c=[],_=0,A=a+(x.e=n.e-t.e)+1;for(x.s=s,s=0>A?0:A,m.unshift(0);b++<c;w.push(0));do{for(h=0;10>h;h++){if(c!=(b=w.length))d=c>b?1:-1;else for(p=-1,d=0;++p<c;)if(i[p]!=w[p]){d=i[p]>w[p]?1:-1;break}if(!(0>d))break;for(l=b==c?i:m;b;){if(w[--b]<l[b]){for(p=b;p&&!w[--p];w[p]=9);--w[p],w[b]+=10}w[b]-=l[b]}for(;!w[0];w.shift());}$[_++]=d?h:++h,w[0]&&d?w[b]=r[v]||0:w=[r[v]]}while((v++<y||w[0]!==g)&&s--);return $[0]||1==_||($.shift(),x.e--),_>A&&o(x,a,e.RM,w[0]!==g),x},g.eq=function(t){return!this.cmp(t)},g.gt=function(t){return this.cmp(t)>0},g.gte=function(t){return this.cmp(t)>-1},g.lt=function(t){return this.cmp(t)<0},g.lte=function(t){return this.cmp(t)<1},g.sub=g.minus=function(t){var n,e,r,i,s=this,o=s.constructor,u=s.s,a=(t=new o(t)).s;if(u!=a)return t.s=-a,s.plus(t);var c=s.c.slice(),l=s.e,f=t.c,h=t.e;if(!c[0]||!f[0])return f[0]?(t.s=-a,t):new o(c[0]?s:0);if(u=l-h){for((i=0>u)?(u=-u,r=c):(h=l,r=f),r.reverse(),a=u;a--;r.push(0));r.reverse()}else for(e=((i=c.length<f.length)?c:f).length,u=a=0;e>a;a++)if(c[a]!=f[a]){i=c[a]<f[a];break}if(i&&(r=c,c=f,f=r,t.s=-t.s),(a=(e=f.length)-(n=c.length))>0)for(;a--;c[n++]=0);for(a=n;e>u;){if(c[--e]<f[e]){for(n=e;n&&!c[--n];c[n]=9);--c[n],c[e]+=10}c[e]-=f[e]}for(;0===c[--a];c.pop());for(;0===c[0];)c.shift(),--h;return c[0]||(t.s=1,c=[h=0]),t.c=c,t.e=h,t},g.mod=function(t){var n,e=this,r=e.constructor,i=e.s,s=(t=new r(t)).s;return t.c[0]||u(NaN),e.s=t.s=1,n=1==t.cmp(e),e.s=i,t.s=s,n?new r(e):(i=r.DP,s=r.RM,r.DP=r.RM=0,e=e.div(t),r.DP=i,r.RM=s,this.minus(e.times(t)))},g.add=g.plus=function(t){var n,e=this,r=e.constructor,i=e.s,s=(t=new r(t)).s;if(i!=s)return t.s=-s,e.minus(t);var o=e.e,u=e.c,a=t.e,c=t.c;if(!u[0]||!c[0])return c[0]?t:new r(u[0]?e:0*i);if(u=u.slice(),i=o-a){for(i>0?(a=o,n=c):(i=-i,n=u),n.reverse();i--;n.push(0));n.reverse()}for(u.length-c.length<0&&(n=c,c=u,u=n),i=c.length,s=0;i;)s=(u[--i]=u[i]+c[i]+s)/10|0,u[i]%=10;for(s&&(u.unshift(s),++a),i=u.length;0===u[--i];u.pop());return t.c=u,t.e=a,t},g.pow=function(t){var n=this,e=new n.constructor(1),r=e,i=0>t;for((t!==~~t||-h>t||t>h)&&u("!pow!"),t=i?-t:t;1&t&&(r=r.times(n)),t>>=1,t;)n=n.times(n);return i?e.div(r):r},g.round=function(t,n){var e=this,r=e.constructor;return null==t?t=0:(t!==~~t||0>t||t>f)&&u("!round!"),o(e=new r(e),t,null==n?r.RM:n),e},g.sqrt=function(){var t,n,e,r=this,i=r.constructor,s=r.c,a=r.s,c=r.e,l=new i("0.5");if(!s[0])return new i(r);0>a&&u(NaN),a=Math.sqrt(r.toString()),0===a||a===1/0?(t=s.join(""),t.length+c&1||(t+="0"),n=new i(Math.sqrt(t).toString()),n.e=((c+1)/2|0)-(0>c||1&c)):n=new i(a.toString()),a=n.e+(i.DP+=4);do e=n,n=l.times(e.plus(r.div(e)));while(e.c.slice(0,a).join("")!==n.c.slice(0,a).join(""));return o(n,i.DP-=4,i.RM),n},g.mul=g.times=function(t){var n,e=this,r=e.constructor,i=e.c,s=(t=new r(t)).c,o=i.length,u=s.length,a=e.e,c=t.e;if(t.s=e.s==t.s?1:-1,!i[0]||!s[0])return new r(0*t.s);for(t.e=a+c,u>o&&(n=i,i=s,s=n,c=o,o=u,u=c),n=new Array(c=o+u);c--;n[c]=0);for(a=u;a--;){for(u=0,c=o+a;c>a;)u=n[c]+s[a]*i[c-a-1]+u,n[c--]=u%10,u=u/10|0;n[c]=(n[c]+u)%10}for(u&&++t.e,n[0]||n.shift(),a=n.length;!n[--a];n.pop());return t.c=n,t},g.toString=g.valueOf=g.toJSON=function(){var t=this,n=t.e,e=t.c.join(""),r=e.length;if(d>=n||n>=p)e=e.charAt(0)+(r>1?"."+e.slice(1):"")+(0>n?"e":"e+")+n;else if(0>n){for(;++n;e="0"+e);e="0."+e}else if(n>0)if(++n>r)for(n-=r;n--;e+="0");else r>n&&(e=e.slice(0,n)+"."+e.slice(n));else r>1&&(e=e.charAt(0)+"."+e.slice(1));return t.s<0&&t.c[0]?"-"+e:e},g.toExponential=function(t){return null==t?t=this.c.length-1:(t!==~~t||0>t||t>f)&&u("!toExp!"),i(this,t,1)},g.toFixed=function(t){var n,e=this,r=d,s=p;return d=-(p=1/0),null==t?n=e.toString():t===~~t&&t>=0&&f>=t&&(n=i(e,e.e+t),e.s<0&&e.c[0]&&n.indexOf("-")<0&&(n="-"+n)),d=r,p=s,n||u("!toFix!"),n},g.toPrecision=function(t){return null==t?this.toString():((t!==~~t||1>t||t>f)&&u("!toPre!"),i(this,t-1,2))},a=r(),"function"==typeof t&&t.amd?t(function(){return a}):"undefined"!=typeof e&&e.exports?e.exports=a:n.Big=a}(this)},{}],8:[function(t,n,e){randomInt=function(t){if((void 0===t||null===t)&&(t={}),(void 0===t.min||null===t)&&(t.min=0),(void 0===t.max||null===t)&&(t.max=4294967295),t.min>t.max){var n=t.min;t.min=t.max,t.max=n}return Math.floor(Math.random()*(t.max-t.min)+t.min)},randomFloat=function(t){return(void 0===t||null===t)&&(t={}),(void 0===t.min||null===t)&&(t.min=0),(void 0===t.max||null===t)&&(t.max=1),Math.random()*(t.max-t.min)+t.min},randomString=function(t){(void 0===t||null===t)&&(t={}),(void 0===t.length||null===t.length)&&(t.length=20),(void 0===t.set||null===t.set)&&(t.set="alphanum");var n;switch(t.set){case"alpha":n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";break;case"alphanum":n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";break;case"num":n="0123456789";break;case"hex":n="0123456789ABCDEF";break;case"custom":if(void 0===t.custom||null===t.custom)return console.error("can't generate a random string with custom set of characters if options.custom is null or undefined"),"";n=t.custom}for(var e="",r=0;r<t.length;r++){var i=randomInt({min:0,max:n.length});e+=n[i]}return e},n.exports.randomInt=randomInt,n.exports.randomFloat=randomFloat,n.exports.randomString=randomString},{}],9:[function(t,n,e){var r,i=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===s.call(t)},u=function(t){"use strict";if(!t||"[object Object]"!==s.call(t))return!1;var n=i.call(t,"constructor"),e=t.constructor&&t.constructor.prototype&&i.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!n&&!e)return!1;var o;for(o in t);return o===r||i.call(t,o)};n.exports=function a(){"use strict";var t,n,e,i,s,c,l=arguments[0],f=1,h=arguments.length,d=!1;for("boolean"==typeof l?(d=l,l=arguments[1]||{},f=2):("object"!=typeof l&&"function"!=typeof l||null==l)&&(l={});h>f;++f)if(t=arguments[f],null!=t)for(n in t)e=l[n],i=t[n],l!==i&&(d&&i&&(u(i)||(s=o(i)))?(s?(s=!1,c=e&&o(e)?e:[]):c=e&&u(e)?e:{},l[n]=a(d,c,i)):i!==r&&(l[n]=i));return l}},{}],10:[function(t,n,e){n.exports=function(t){t.plural(/$/,"s"),t.plural(/s$/i,"s"),t.plural(/(ax|test)is$/i,"$1es"),t.plural(/(octop|vir)us$/i,"$1i"),t.plural(/(octop|vir)i$/i,"$1i"),t.plural(/(alias|status)$/i,"$1es"),t.plural(/(bu)s$/i,"$1ses"),t.plural(/(buffal|tomat)o$/i,"$1oes"),t.plural(/([ti])um$/i,"$1a"),t.plural(/([ti])a$/i,"$1a"),t.plural(/sis$/i,"ses"),t.plural(/(?:([^f])fe|([lr])f)$/i,"$1ves"),t.plural(/(hive)$/i,"$1s"),t.plural(/([^aeiouy]|qu)y$/i,"$1ies"),t.plural(/(x|ch|ss|sh)$/i,"$1es"),t.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),t.plural(/([m|l])ouse$/i,"$1ice"),t.plural(/([m|l])ice$/i,"$1ice"),t.plural(/^(ox)$/i,"$1en"),t.plural(/^(oxen)$/i,"$1"),t.plural(/(quiz)$/i,"$1zes"),t.singular(/s$/i,""),t.singular(/(n)ews$/i,"$1ews"),t.singular(/([ti])a$/i,"$1um"),t.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1sis"),t.singular(/(^analy)ses$/i,"$1sis"),t.singular(/([^f])ves$/i,"$1fe"),t.singular(/(hive)s$/i,"$1"),t.singular(/(tive)s$/i,"$1"),t.singular(/([lr])ves$/i,"$1f"),t.singular(/([^aeiouy]|qu)ies$/i,"$1y"),t.singular(/(s)eries$/i,"$1eries"),t.singular(/(m)ovies$/i,"$1ovie"),t.singular(/(x|ch|ss|sh)es$/i,"$1"),t.singular(/([m|l])ice$/i,"$1ouse"),t.singular(/(bus)es$/i,"$1"),t.singular(/(o)es$/i,"$1"),t.singular(/(shoe)s$/i,"$1"),t.singular(/(cris|ax|test)es$/i,"$1is"),t.singular(/(octop|vir)i$/i,"$1us"),t.singular(/(alias|status)es$/i,"$1"),t.singular(/^(ox)en/i,"$1"),t.singular(/(vert|ind)ices$/i,"$1ex"),t.singular(/(matr)ices$/i,"$1ix"),t.singular(/(quiz)zes$/i,"$1"),t.singular(/(database)s$/i,"$1"),t.irregular("child","children"),t.irregular("person","people"),t.irregular("man","men"),t.irregular("child","children"),t.irregular("sex","sexes"),t.irregular("move","moves"),t.irregular("cow","kine"),t.irregular("zombie","zombies"),t.uncountable(["equipment","information","rice","money","species","series","fish","sheep","jeans"])}},{}],11:[function(t,n,e){n.exports=function(n){var e=t("./methods");return n&&t("./native")(e),e}},{"./methods":13,"./native":14}],12:[function(t,n,e){var r=t("./util"),i=function(){return this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[],t("./defaults")(this),this};i.prototype.plural=function(t,n){"string"==typeof t&&(this.uncountables=r.array.del(this.uncountables,t)),this.uncountables=r.array.del(this.uncountables,n),this.plurals.unshift([t,n])},i.prototype.singular=function(t,n){"string"==typeof t&&(this.uncountables=r.array.del(this.uncountables,t)),this.uncountables=r.array.del(this.uncountables,n),this.singulars.unshift([t,n])},i.prototype.irregular=function(t,n){this.uncountables=r.array.del(this.uncountables,t),this.uncountables=r.array.del(this.uncountables,n),t[0].toUpperCase()==n[0].toUpperCase()?(this.plural(new RegExp("("+t[0]+")"+t.slice(1)+"$","i"),"$1"+n.slice(1)),this.plural(new RegExp("("+n[0]+")"+n.slice(1)+"$","i"),"$1"+n.slice(1)),this.singular(new RegExp("("+n[0]+")"+n.slice(1)+"$","i"),"$1"+t.slice(1))):(this.plural(new RegExp(""+t[0].toUpperCase()+t.slice(1)+"$"),n[0].toUpperCase()+n.slice(1)),this.plural(new RegExp(""+t[0].toLowerCase()+t.slice(1)+"$"),n[0].toLowerCase()+n.slice(1)),this.plural(new RegExp(""+n[0].toUpperCase()+n.slice(1)+"$"),n[0].toUpperCase()+n.slice(1)),this.plural(new RegExp(""+n[0].toLowerCase()+n.slice(1)+"$"),n[0].toLowerCase()+n.slice(1)),this.singular(new RegExp(""+n[0].toUpperCase()+n.slice(1)+"$"),t[0].toUpperCase()+t.slice(1)),this.singular(new RegExp(""+n[0].toLowerCase()+n.slice(1)+"$"),t[0].toLowerCase()+t.slice(1)))},i.prototype.human=function(t,n){this.humans.unshift([t,n])},i.prototype.uncountable=function(t){this.uncountables=this.uncountables.concat(t)},i.prototype.clear=function(t){switch(null==t&&(t="all"),t){case"all":this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[];default:this[t]=[]}},i.prototype["default"]=function(){return this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[],t("./defaults")(this),this},n.exports=new i},{"./defaults":10,"./util":15}],13:[function(t,n,e){var r=t("./util"),i=n.exports;i.inflections=t("./inflections"),i.inflect=function(t){t(i.inflections)},i.camelize=function(t,n){var e;return null==n&&(n=!0),e=r.string.gsub(t,/\/(.?)/,function(t){return"."+r.string.upcase(t[1])}),e=r.string.gsub(e,/(?:_)(.)/,function(t){return r.string.upcase(t[1])}),n?r.string.upcase(e):r.string.downcase(e)},i.underscore=function(t){var n;return n=r.string.gsub(t,/\./,"/"),n=r.string.gsub(n,/([A-Z]+)([A-Z][a-z])/,"$1_$2"),n=r.string.gsub(n,/([a-z\d])([A-Z])/,"$1_$2"),n=r.string.gsub(n,/-/,"_"),n.toLowerCase()},i.dasherize=function(t){return r.string.gsub(t,/_/,"-")},i.demodulize=function(t){return r.string.gsub(t,/^.*\./,"")},i.foreign_key=function(t,n){return null==n&&(n=!0),i.underscore(i.demodulize(t))+(n?"_id":"id")},i.ordinalize=function(t){var n;if(t=parseInt(t),11===(n=Math.abs(t)%100)||12===n||13===n)return""+t+"th";switch(Math.abs(t)%10){case 1:return""+t+"st";case 2:return""+t+"nd";case 3:return""+t+"rd";default:return""+t+"th"}},i.uncountability=function(t){return i.inflections.uncountables.some(function(n,e,r){return null!=t.match(new RegExp("(\\b|_)"+n+"$","i"))})},i.pluralize=function(t){var n,e;if(e=t,""===t||i.uncountability(t))return e;for(var s=0;s<i.inflections.plurals.length&&(n=i.inflections.plurals[s],e=r.string.gsub(e,n[0],n[1]),null==t.match(n[0]));s++);return e},i.singularize=function(t){var n,e;if(n=t,""===t||i.uncountability(t))return n;for(var s=0;s<i.inflections.singulars.length&&(e=i.inflections.singulars[s],n=r.string.gsub(n,e[0],e[1]),!t.match(e[0]));s++);return n},i.humanize=function(t){var n,e;e=t;for(var s=0;s<i.inflections.humans.length;s++)n=i.inflections.humans[s],e=r.string.gsub(e,n[0],n[1]);return e=r.string.gsub(e,/_id$/,""),e=r.string.gsub(e,/_/," "),r.string.capitalize(e,!0)},i.titleize=function(t){var n;return n=i.humanize(i.underscore(t)),n=r.string.gsub(n,/[^a-zA-Z:']/," "),r.string.capitalize(n)},i.tableize=function(t){return i.pluralize(i.underscore(t))},i.classify=function(t){return i.camelize(i.singularize(r.string.gsub(t,/.*\./,"")))}},{"./inflections":12,"./util":15}],14:[function(t,n,e){n.exports=function(t){var n=function(t,n){String.prototype.__defineGetter__(t,n)},e=["__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","charAt","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","charCodeAt","indexOf","lastIndexof","length","localeCompare","match","replace","search","slice","split","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimLeft","trimRight","gsub"];Object.keys(t).forEach(function(r){"inflect"!=r&&"inflections"!=r&&(-1!==e.indexOf(r)?console.log("warn: You should not override String.prototype."+r):n(r,function(){return t[r](this)}))})}},{}],15:[function(t,n,e){var r=n.exports={array:{del:function(t,n){var e=t.indexOf(n);return-1!=e?0==e?t.slice(1):t.slice(0,e).concat(t.slice(e+1)):t},first:function(t){return t[0]},last:function(t){return t[t.length-1]}},string:{gsub:function(t,n,e){var i,s,o,u,a,c,l;if(null==n||null==e)return r.string.value(t);for(c="",l=t;l.length>0;)if(s=l.match(n)){if(c+=l.slice(0,s.index),"function"==typeof e)s[1]=s[1]||s[0],c+=e(s);else if(e.match(/\$[1-9]/)){for(u=s,o=r.array.del(s,void 0);o!==u;)u=o,o=r.array.del(o,void 0);for(s[1]=s[1]||s[0],a=e,i=1;9>=i;i++)o[i]&&(a=r.string.gsub(a,new RegExp("\\$"+i),o[i]));c+=a}else c+=e;l=l.slice(s.index+s[0].length)}else c+=l,l="";return c},upcase:function(t){var n=r.string.gsub(t,/_([a-z])/,function(t){return"_"+t[1].toUpperCase()});return n=r.string.gsub(n,/\/([a-z])/,function(t){return"/"+t[1].toUpperCase()}),n[0].toUpperCase()+n.substr(1)},capitalize:function(t,n){var e=t.toLowerCase();return n||(e=r.string.gsub(e,/\s([a-z])/,function(t){return" "+t[1].toUpperCase()})),e[0].toUpperCase()+e.substr(1)},downcase:function(t){var n=r.string.gsub(t,/_([A-Z])/,function(t){
return"_"+t[1].toLowerCase()});return n=r.string.gsub(n,/\/([A-Z])/,function(t){return"/"+t[1].toLowerCase()}),n[0].toLowerCase()+n.substr(1)},value:function(t){return t.substr(0)}}}},{}],16:[function(t,n,e){(function(r){var i=t("fs"),s={};json=function(t,n){n||(n=r.env.NODE_ENV);var e=t+":"+n;if(s[e])return s[e];for(var o,u,a=JSON.parse(i.readFileSync(r.cwd()+"/config/"+t+".json"))[n],c=Object.keys(a),l=0;l<c.length;++l)u=c[l],o=a[u],"string"==typeof o&&(a[u]=o.replace(/\{\{(\w+)\}\}/g,function(t,n,e){return a[n]||t}));return s[e]=a},e=n.exports=json}).call(this,t("_process"))},{_process:19,fs:18}],17:[function(n,e,r){(function(i){!function(n){if("object"==typeof r&&"undefined"!=typeof e)e.exports=n();else if("function"==typeof t&&t.amd)t([],n);else{var s;s="undefined"!=typeof window?window:"undefined"!=typeof i?i:"undefined"!=typeof self?self:this,s.progenitor=n()}}(function(){return function t(e,r,i){function s(u,a){if(!r[u]){if(!e[u]){var c="function"==typeof n&&n;if(!a&&c)return c(u,!0);if(o)return o(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[u]={exports:{}};e[u][0].call(f.exports,function(t){var n=e[u][1][t];return s(n?n:t)},f,f.exports,t,e,r,i)}return r[u].exports}for(var o="function"==typeof n&&n,u=0;u<i.length;u++)s(i[u]);return s}({1:[function(t,n,e){var r,i=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===s.call(t)},u=function(t){"use strict";if(!t||"[object Object]"!==s.call(t))return!1;var n=i.call(t,"constructor"),e=t.constructor&&t.constructor.prototype&&i.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!n&&!e)return!1;var o;for(o in t);return o===r||i.call(t,o)};n.exports=function a(){"use strict";var t,n,e,i,s,c,l=arguments[0],f=1,h=arguments.length,d=!1;for("boolean"==typeof l?(d=l,l=arguments[1]||{},f=2):("object"!=typeof l&&"function"!=typeof l||null==l)&&(l={});h>f;++f)if(t=arguments[f],null!=t)for(n in t)e=l[n],i=t[n],l!==i&&(d&&i&&(u(i)||(s=o(i)))?(s?(s=!1,c=e&&o(e)?e:[]):c=e&&u(e)?e:{},l[n]=a(d,c,i)):i!==r&&(l[n]=i));return l}},{}],2:[function(t,n,e){var r=function(){},i=t("extend"),s={},o=function(t){return t.classMethods||(t.classMethods={}),t.classMethods.inherited||(t.classMethods.inherited=r),t.instanceMethods||(t.instanceMethods={}),t.instanceMethods.init||(t.instanceMethods.init=r),function(n,e,u){var a;if(a=s[n])return a;e=("function"==typeof e?e():e)||{},u=("function"==typeof u?u():u)||{},u.classMethods||(u.classMethods={}),a=function(n){"prototype-definition"!==n&&(t.instanceMethods.init.apply(this,arguments),p.init.apply(this,arguments))};var c=function(n){return t.classMethods[n]&&t.classMethods[n].apply(this,Array.prototype.slice.call(arguments,1))},l={"class":t,className:n,"super":c,progeny:o(a)},f=i({},t.classMethods,l,u.classMethods);i(a,a.classMethods=f);var h=function(n){return t.instanceMethods[n]&&t.instanceMethods[n].apply(this,Array.prototype.slice.call(arguments,1))},d={constructor:t,"class":a,className:n,"super":h,init:r},p=i({},t.instanceMethods,d,e);return a.prototype=new t("prototype-definition"),i(a.prototype,a.instanceMethods=p),t.classMethods.inherited.apply(t,[a]),s[n]=a}};e=n.exports=function(){Object.progeny||(Object.progeny=o(Object)),Error.progeny||(Error.progeny=o(Error))}},{extend:1}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{extend:9}],18:[function(t,n,e){},{}],19:[function(t,n,e){function r(){l=!1,u.length?c=u.concat(c):f=-1,c.length&&i()}function i(){if(!l){var t=setTimeout(r);l=!0;for(var n=c.length;n;){for(u=c,c=[];++f<n;)u[f].run();f=-1,n=c.length}u=null,l=!1,clearTimeout(t)}}function s(t,n){this.fun=t,this.array=n}function o(){}var u,a=n.exports={},c=[],l=!1,f=-1;a.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)n[e-1]=arguments[e];c.push(new s(t,n)),1!==c.length||l||setTimeout(i,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=o,a.addListener=o,a.once=o,a.off=o,a.removeListener=o,a.removeAllListeners=o,a.emit=o,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],20:[function(t,n,e){function r(t){var n=t.id||t._id;this.persisted=!1,n?Document.Adapter.ids.isValid(n)?this.id=Document.Adapter.ids.next(n):"ObjectID"===n._bsontype?this.id=n:this.id=n.toString():null===n?this.id=null:this.id=Document.Adapter.ids.next(),this.set(u({_id:this.id},s(t,["id","_id"]))),this._changes={}}function i(t){var n=new this({_id:null});return this.adapter()[t].call(this.adapter(),function(t){t=n["class"].shortToLong(t),n.kept(t)}),n}function s(t,n){var e={};for(var r in t)-1==n.indexOf(r)&&(e[r]=t[r]);return e}function o(t,n){if(!n||"object"!=typeof n)return n;var e={};return Object.keys(n).forEach(function(r){e[t[r]||r]=n[r]}),e}t("progenitor.js")();var u=t("extend"),a=t("i")(),c={},l=function(){};Document=Object.progeny("Document",{init:function(t,n){this._data={},this._changes={},r.call(this,t),this.relation=n,this.RSVP={success:l,error:l},this.loaded=!1},isValid:function(){var t,n,e=!0,r=this["class"].validate||{},i=r.presence||[],s=r.format||{},o=Object.keys(s),u=r.custom||[];for(t=0;t<i.length;++t)if(!this.get(i[t])){e=!1;break}if(!e)return!1;for(t=0;t<o.length;++t)if(n=o[t],!s[n].test(this.get(n))){e=!1;break}for(t=0;t<u.length;++t)if(!u[t].call(this)){e=!1;break}return e},get:function(t){if("id"==t)return this.id;if(this["class"].belongsTo.indexOf(t)>=0){var n=this.get(a.foreign_key(t));return n&&Document[a.classify(t)].find(n)}return this["class"].namedFields[t]?this._data[t]||null:void 0},set:function(){var t,n,e,r=arguments[0],i=2==arguments.length,s={};if(arguments[0]){i&&(r={},r[arguments[0]]=arguments[1]);for(t in r){var o=this["class"].belongsTo.indexOf(t)>=0;if(o){var u=a.foreign_key(t);r[u]=r[t].id,t=u}(o||this["class"].namedFields[t])&&((n=this.get(t))!=(e=r[t])&&(this._changes[t]=[n,e]),"_id"===t&&(this.id=e),this._data[t]=s[t]=e)}return i?s[arguments[0]]:s}},changedAttributes:function(){return u({},this._changes)},save:function(){var t=this,n={},e=!this.isValid(),r=!Object.keys(this.changedAttributes()).length;return e||r&&this.persisted?(this.loaded=!0,this):(this.loaded=!1,this.relation=new Document.Relation(this["class"],this),this.persisted?(Object.keys(this._changes).forEach(function(e){n[e]=t.get(e)}),this.relation.update(n)):((this["class"].beforeCreate||[]).forEach(function(n){n.call(t)}),this.relation.create(u({},this._data))))},update:function(){return this.set.apply(this,arguments),this.save()},destroy:function(){var t=this;return this.loaded=!1,this["class"].adapter().remove({_id:this.id},function(n){t.loaded=!0,t.kept(t.isDestroyed=!!n)}),this},kept:function(t){this.set(t),this.loaded=!0,(this.RSVP.wasKept=!!t)?(this._changes={},this.persisted=!0,this.RSVP.success(this)):this.RSVP.error()},then:function(t,n){this.RSVP.success=t||l,this.RSVP.error=n||l,this.loaded&&(this.RSVP.wasKept?this.RSVP.success(this):this.RSVP.error())},asJSON:function(){for(var t,n={id:this.id.toString(),createdAt:this.get("createdAt"),updatedAt:this.get("updatedAt")},e=0;e<this["class"].allow.length;++e)if(t=this["class"].allow[e],/(.+)_id$/.test(t)){var r=this.get(t);n[t.slice(0,-3)]={id:r?r.toString():r}}else n[t]=this.get(t);return n}},{classMethods:{namedFields:null,shortFields:null,defaultFields:{ObjectID:{_id:"_id"},Date:{createdAt:"cT",updatedAt:"uT"}},adapter:function(){return c[this.className]||(c[this.className]=new Document.Adapter(this))},inherited:function(t){var n;this[t.className]=t,t.fields||(t.fields={}),t.belongsTo||(t.belongsTo=[]),t.fields.ObjectID=u({},this.defaultFields.ObjectID,t.fields.ObjectID),t.fields.Date=u({},this.defaultFields.Date,t.fields.Date),t.namedFields={},t.shortFields={},t.belongsTo.forEach(function(n){t.fields.ObjectID[a.foreign_key(n)]=n.slice(0,1)+"_id"});for(var e in t.fields)for(var r in n=t.fields[e])t.namedFields[r]=n[r],t.shortFields[n[r]]=r},find:function(t){var n;if(!t||"string"!=typeof t&&"ObjectID"!==t._bsontype)return new Document.Relation(this).find(t);this.loaded=!1,t=Document.Adapter.ids.isValid(t)?Document.Adapter.ids.next(t):t;var e=new Document.Relation(this,n=new this({_id:t}));return(n.relation=e).find()},count:function(){return new Document.Relation(this).count()},first:function(){return i.call(this,"first")},last:function(){return i.call(this,"last")},shortToLong:function(t){return o.call(this,this.shortFields,t)},longToShort:function(t){return o.call(this,this.namedFields,t)}}}),u(Document,{Relation:t("./relation"),Count:t("./count")}),e=n.exports=function(n){if(n=n||{},n.store||(n.store="memory"),-1=="memory mongo".split(" ").indexOf(n.store))throw new Error("Only the `memory` and `mongo` stores are available.");return t("./memory_adapter"),t("./mongo_adapter"),Document.Adapter=t("./"+n.store+"_adapter"),Document}},{"./count":2,"./memory_adapter":3,"./mongo_adapter":4,"./relation":5,extend:9,i:11,"progenitor.js":17}]},{},[20])(20)});