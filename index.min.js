!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.model=t()}}(function(){var t;return function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,n){t("progenitor.js")();var r=function(t){t&&t()};Adapter=Object.progeny("Adapter",{init:function(t){this.modelClass=t}},{classMethods:{connect:r,clear:r,disconnect:r}}),n=e.exports=Adapter},{"progenitor.js":15}],2:[function(t,e,n){function r(t){return!isNaN(parseFloat(t))&&isFinite(t)}function i(){this.loaded&&(null===this.count?this.RSVP.error.call(this):this.RSVP.success.call(this,this.count))}t("progenitor.js")();var s=function(){};Count=Object.progeny("Count",{init:function(t){this.relation=t,this.count=null,this.loaded=!1,this.RSVP={success:s,error:s}},kept:function(t){this.count=r(t)?t:null,this.loaded=!0,i.call(this)},then:function(t,e){this.RSVP.success=t||s,this.RSVP.error=e||s,i.call(this)}}),n=e.exports=Count},{"progenitor.js":15}],3:[function(t,e,n){var r=function(){},i=[],s=t("extend"),o=t("base-62.js"),u=t("./adapter");MemoryAdapter=u.progeny("MemoryAdapter",{init:function(){this._data=[]},create:function(t,e){this._data.push(t),i.push(this),e(t)},update:function(t,e,n){var r=0;this.where(t,function(t){r=t.length,t.forEach(function(t){s(t,e)}),n(r||null)})},count:function(t){t(this._data.length)},first:function(t){t(this._data[0]||null)},last:function(t){t(this._data[this._data.length-1]||null)},where:function(t,e){if(!t)return void(e&&e(null));var n=Object.keys(t);n.length||e(this.all()),e(this._data.filter(function(e){var r=!0;return n.forEach(function(n){e[n]!==t[n]&&(r=!1)}),r}))},all:function(){return this._data.slice()},remove:function(t,e){this._data=this._data.filter(function(e){return e._id!==t._id}),e(!0)},clear:function(t){this._data=[],t(!0)}},{classMethods:{clear:function(){i.forEach(function(t){t.clear(r)})},ids:{isValid:function(t){return!!t},next:function(t){return t||o.token()}}}}),n=e.exports=MemoryAdapter},{"./adapter":1,"base-62.js":5,extend:8}],4:[function(t,e,n){function r(t){return!isNaN(parseFloat(t))&&isFinite(t)}function i(){this.loaded&&(this.RSVP.wasKept?this.RSVP.success.call(this,this.RSVP.wasKept):this.RSVP.error.call(this))}RelationError=Error.progeny("RelationError",{init:function(t){this.name=this.className,this.message=t}});var s=t("extend"),o=function(){};Relation=Object.progeny("Relation",{init:function(t,e){this.modelClass=t,this.adapter=t.adapter,e?this.model=e:this._query={},this.loaded=!1,this.items=null,this.size=null,this.RSVP={success:o,error:o,wasKept:!1}},kept:function(t){this.loaded=!0,this.RSVP.wasKept=t,this.items=this.size=null,Array.isArray(t)?this.items=t:r(t)&&(this.size=t),i.call(this)},then:function(t,e){this.RSVP.success=t||o,this.RSVP.error=e||o,i.call(this)},query:function(){return this._query?s({},this._query):null},count:function(){var t=this,e=new Document.Count(this);return this.adapter.count(function(n){t.loaded=!0,e.kept(n)}),e},find:function(t){var e=this;if(this.loaded=!1,this.model)return this.adapter.where({_id:this.model.id},function(t){e.loaded=!0,t=Array.isArray(t)?e.model["class"].shortToLong(t[0]):t,e.model.kept(t)}),this.model;var n=this.modelClass;return t=n.longToShort(t),this.adapter.where(t,function(t){Array.isArray(t)&&(t=t.map(function(t){var e=new n({_id:null});return e.kept(n.shortToLong(t)),e})),e.kept(t)}),this},asJSON:function(){return this.items?this.items.map(function(t){return t.asJSON()}):r(this.size)?this.size:null},create:function(t){var e=this;if(this.loaded=!1,!this.model)throw new RelationError("Non-model creates are not supported.");return t=this.modelClass.longToShort(t),this.adapter.create(t,function(t){e.loaded=!0,t=e.model["class"].shortToLong(t),e.model.kept(t)}),this.model},update:function(t){var e=this;return this.loaded=!1,t=this.modelClass.longToShort(t),this.model?(this.adapter.update({_id:this.model.id},t,function(t){e.loaded=!0,e.model.kept(t)}),this.model):(this.adapter.update(this._query,t,function(t){e.kept(t)}),this)}}),n=e.exports=Relation},{extend:8}],5:[function(e,n,r){(function(i){!function(e){if("object"==typeof r&&"undefined"!=typeof n)n.exports=e();else if("function"==typeof t&&t.amd)t([],e);else{var s;s="undefined"!=typeof window?window:"undefined"!=typeof i?i:"undefined"!=typeof self?self:this,s.base62=e()}}(function(){var t;return function n(t,r,i){function s(u,a){if(!r[u]){if(!t[u]){var l="function"==typeof e&&e;if(!a&&l)return l(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[u]={exports:{}};t[u][0].call(f.exports,function(e){var n=t[u][1][e];return s(n?n:e)},f,f.exports,n,t,r,i)}return r[u].exports}for(var o="function"==typeof e&&e,u=0;u<i.length;u++)s(i[u]);return s}({1:[function(e,n,r){!function(e){"use strict";function r(){function t(e){var n=this;return n instanceof t?(e instanceof t?(n.s=e.s,n.e=e.e,n.c=e.c.slice()):s(n,e),void(n.constructor=t)):void 0===e?r():new t(e)}return t.prototype=g,t.DP=l,t.RM=c,t}function i(t,e,n){var r=t.constructor,i=e-(t=new r(t)).e,s=t.c;for(s.length>++e&&o(t,i,r.RM),s[0]?n?i=e:(s=t.c,i=t.e+i+1):++i;s.length<i;s.push(0));return i=t.e,1===n||n&&(i>=e||d>=i)?(t.s<0&&s[0]?"-":"")+(s.length>1?s[0]+"."+s.join("").slice(1):s[0])+(0>i?"e":"e+")+i:t.toString()}function s(t,e){var n,r,i;for(0===e&&0>1/e?e="-0":m.test(e+="")||u(NaN),t.s="-"==e.charAt(0)?(e=e.slice(1),-1):1,(n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(0>n&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):0>n&&(n=e.length),r=0;"0"==e.charAt(r);r++);if(r==(i=e.length))t.c=[t.e=0];else{for(;"0"==e.charAt(--i););for(t.e=n-r-1,t.c=[],n=0;i>=r;t.c[n++]=+e.charAt(r++));}return t}function o(t,e,n,r){var i,s=t.c,o=t.e+e+1;if(1===n?r=s[o]>=5:2===n?r=s[o]>5||5==s[o]&&(r||0>o||s[o+1]!==i||1&s[o-1]):3===n?r=r||s[o]!==i||0>o:(r=!1,0!==n&&u("!Big.RM!")),1>o||!s[0])r?(t.e=-e,t.c=[1]):t.c=[t.e=0];else{if(s.length=o--,r)for(;++s[o]>9;)s[o]=0,o--||(++t.e,s.unshift(1));for(o=s.length;!s[--o];s.pop());}return t}function u(t){var e=new Error(t);throw e.name="BigError",e}var a,l=20,c=1,f=1e6,h=1e6,d=-7,p=21,g={},m=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;g.abs=function(){var t=new this.constructor(this);return t.s=1,t},g.cmp=function(t){var e,n=this,r=n.c,i=(t=new n.constructor(t)).c,s=n.s,o=t.s,u=n.e,a=t.e;if(!r[0]||!i[0])return r[0]?s:i[0]?-o:0;if(s!=o)return s;if(e=0>s,u!=a)return u>a^e?1:-1;for(s=-1,o=(u=r.length)<(a=i.length)?u:a;++s<o;)if(r[s]!=i[s])return r[s]>i[s]^e?1:-1;return u==a?0:u>a^e?1:-1},g.div=function(t){var e=this,n=e.constructor,r=e.c,i=(t=new n(t)).c,s=e.s==t.s?1:-1,a=n.DP;if((a!==~~a||0>a||a>f)&&u("!Big.DP!"),!r[0]||!i[0])return r[0]==i[0]&&u(NaN),i[0]||u(s/0),new n(0*s);var l,c,h,d,p,g,m=i.slice(),v=l=i.length,y=r.length,b=r.slice(0,l),w=b.length,x=t,$=x.c=[],_=0,S=a+(x.e=e.e-t.e)+1;for(x.s=s,s=0>S?0:S,m.unshift(0);w++<l;b.push(0));do{for(h=0;10>h;h++){if(l!=(w=b.length))d=l>w?1:-1;else for(p=-1,d=0;++p<l;)if(i[p]!=b[p]){d=i[p]>b[p]?1:-1;break}if(!(0>d))break;for(c=w==l?i:m;w;){if(b[--w]<c[w]){for(p=w;p&&!b[--p];b[p]=9);--b[p],b[w]+=10}b[w]-=c[w]}for(;!b[0];b.shift());}$[_++]=d?h:++h,b[0]&&d?b[w]=r[v]||0:b=[r[v]]}while((v++<y||b[0]!==g)&&s--);return $[0]||1==_||($.shift(),x.e--),_>S&&o(x,a,n.RM,b[0]!==g),x},g.eq=function(t){return!this.cmp(t)},g.gt=function(t){return this.cmp(t)>0},g.gte=function(t){return this.cmp(t)>-1},g.lt=function(t){return this.cmp(t)<0},g.lte=function(t){return this.cmp(t)<1},g.sub=g.minus=function(t){var e,n,r,i,s=this,o=s.constructor,u=s.s,a=(t=new o(t)).s;if(u!=a)return t.s=-a,s.plus(t);var l=s.c.slice(),c=s.e,f=t.c,h=t.e;if(!l[0]||!f[0])return f[0]?(t.s=-a,t):new o(l[0]?s:0);if(u=c-h){for((i=0>u)?(u=-u,r=l):(h=c,r=f),r.reverse(),a=u;a--;r.push(0));r.reverse()}else for(n=((i=l.length<f.length)?l:f).length,u=a=0;n>a;a++)if(l[a]!=f[a]){i=l[a]<f[a];break}if(i&&(r=l,l=f,f=r,t.s=-t.s),(a=(n=f.length)-(e=l.length))>0)for(;a--;l[e++]=0);for(a=e;n>u;){if(l[--n]<f[n]){for(e=n;e&&!l[--e];l[e]=9);--l[e],l[n]+=10}l[n]-=f[n]}for(;0===l[--a];l.pop());for(;0===l[0];)l.shift(),--h;return l[0]||(t.s=1,l=[h=0]),t.c=l,t.e=h,t},g.mod=function(t){var e,n=this,r=n.constructor,i=n.s,s=(t=new r(t)).s;return t.c[0]||u(NaN),n.s=t.s=1,e=1==t.cmp(n),n.s=i,t.s=s,e?new r(n):(i=r.DP,s=r.RM,r.DP=r.RM=0,n=n.div(t),r.DP=i,r.RM=s,this.minus(n.times(t)))},g.add=g.plus=function(t){var e,n=this,r=n.constructor,i=n.s,s=(t=new r(t)).s;if(i!=s)return t.s=-s,n.minus(t);var o=n.e,u=n.c,a=t.e,l=t.c;if(!u[0]||!l[0])return l[0]?t:new r(u[0]?n:0*i);if(u=u.slice(),i=o-a){for(i>0?(a=o,e=l):(i=-i,e=u),e.reverse();i--;e.push(0));e.reverse()}for(u.length-l.length<0&&(e=l,l=u,u=e),i=l.length,s=0;i;)s=(u[--i]=u[i]+l[i]+s)/10|0,u[i]%=10;for(s&&(u.unshift(s),++a),i=u.length;0===u[--i];u.pop());return t.c=u,t.e=a,t},g.pow=function(t){var e=this,n=new e.constructor(1),r=n,i=0>t;for((t!==~~t||-h>t||t>h)&&u("!pow!"),t=i?-t:t;1&t&&(r=r.times(e)),t>>=1,t;)e=e.times(e);return i?n.div(r):r},g.round=function(t,e){var n=this,r=n.constructor;return null==t?t=0:(t!==~~t||0>t||t>f)&&u("!round!"),o(n=new r(n),t,null==e?r.RM:e),n},g.sqrt=function(){var t,e,n,r=this,i=r.constructor,s=r.c,a=r.s,l=r.e,c=new i("0.5");if(!s[0])return new i(r);0>a&&u(NaN),a=Math.sqrt(r.toString()),0===a||a===1/0?(t=s.join(""),t.length+l&1||(t+="0"),e=new i(Math.sqrt(t).toString()),e.e=((l+1)/2|0)-(0>l||1&l)):e=new i(a.toString()),a=e.e+(i.DP+=4);do n=e,e=c.times(n.plus(r.div(n)));while(n.c.slice(0,a).join("")!==e.c.slice(0,a).join(""));return o(e,i.DP-=4,i.RM),e},g.mul=g.times=function(t){var e,n=this,r=n.constructor,i=n.c,s=(t=new r(t)).c,o=i.length,u=s.length,a=n.e,l=t.e;if(t.s=n.s==t.s?1:-1,!i[0]||!s[0])return new r(0*t.s);for(t.e=a+l,u>o&&(e=i,i=s,s=e,l=o,o=u,u=l),e=new Array(l=o+u);l--;e[l]=0);for(a=u;a--;){for(u=0,l=o+a;l>a;)u=e[l]+s[a]*i[l-a-1]+u,e[l--]=u%10,u=u/10|0;e[l]=(e[l]+u)%10}for(u&&++t.e,e[0]||e.shift(),a=e.length;!e[--a];e.pop());return t.c=e,t},g.toString=g.valueOf=g.toJSON=function(){var t=this,e=t.e,n=t.c.join(""),r=n.length;if(d>=e||e>=p)n=n.charAt(0)+(r>1?"."+n.slice(1):"")+(0>e?"e":"e+")+e;else if(0>e){for(;++e;n="0"+n);n="0."+n}else if(e>0)if(++e>r)for(e-=r;e--;n+="0");else r>e&&(n=n.slice(0,e)+"."+n.slice(e));else r>1&&(n=n.charAt(0)+"."+n.slice(1));return t.s<0&&t.c[0]?"-"+n:n},g.toExponential=function(t){return null==t?t=this.c.length-1:(t!==~~t||0>t||t>f)&&u("!toExp!"),i(this,t,1)},g.toFixed=function(t){var e,n=this,r=d,s=p;return d=-(p=1/0),null==t?e=n.toString():t===~~t&&t>=0&&f>=t&&(e=i(n,n.e+t),n.s<0&&n.c[0]&&e.indexOf("-")<0&&(e="-"+e)),d=r,p=s,e||u("!toFix!"),e},g.toPrecision=function(t){return null==t?this.toString():((t!==~~t||1>t||t>f)&&u("!toPre!"),i(this,t-1,2))},a=r(),"function"==typeof t&&t.amd?t(function(){return a}):"undefined"!=typeof n&&n.exports?n.exports=a:e.Big=a}(this)},{}],2:[function(t,e,n){randomInt=function(t){if((void 0===t||null===t)&&(t={}),(void 0===t.min||null===t)&&(t.min=0),(void 0===t.max||null===t)&&(t.max=4294967295),t.min>t.max){var e=t.min;t.min=t.max,t.max=e}return Math.floor(Math.random()*(t.max-t.min)+t.min)},randomFloat=function(t){return(void 0===t||null===t)&&(t={}),(void 0===t.min||null===t)&&(t.min=0),(void 0===t.max||null===t)&&(t.max=1),Math.random()*(t.max-t.min)+t.min},randomString=function(t){(void 0===t||null===t)&&(t={}),(void 0===t.length||null===t.length)&&(t.length=20),(void 0===t.set||null===t.set)&&(t.set="alphanum");var e;switch(t.set){case"alpha":e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";break;case"alphanum":e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";break;case"num":e="0123456789";break;case"hex":e="0123456789ABCDEF";break;case"custom":if(void 0===t.custom||null===t.custom)return console.error("can't generate a random string with custom set of characters if options.custom is null or undefined"),"";e=t.custom}for(var n="",r=0;r<t.length;r++){var i=randomInt({min:0,max:e.length});n+=e[i]}return n},e.exports.randomInt=randomInt,e.exports.randomFloat=randomFloat,e.exports.randomString=randomString},{}],3:[function(t,e,n){function r(){return Base62.encode(f())}function i(t){var e=l(t,10,16);return e?e:null}function s(t){return l(t.toString().toLowerCase(),16,10)}function o(t,e,n){for(var r=[],i=Math.max(t.length,e.length),s=0,o=0;i>o||s;){var u=o<t.length?t[o]:0,a=o<e.length?e[o]:0,l=s+u+a;r.push(l%n),s=Math.floor(l/n),o++}return r}function u(t,e,n){if(0>t)return null;if(0==t)return[];for(var r=[],i=e;;){if(1&t&&(r=o(r,i,n)),t>>=1,0===t)break;i=o(i,i,n)}return r}function a(t,e){for(var n=t.split(""),r=[],i=n.length-1;i>=0;i--){var s=parseInt(n[i],e);if(isNaN(s))return null;r.push(s)}return r}function l(t,e,n){var r=a(t,e);if(null===r)return null;for(var i=[],s=[1],l=0;l<r.length;l++)r[l]&&(i=o(i,u(r[l],s,n),n)),s=u(e,s,n);for(var c="",l=i.length-1;l>=0;l--)c+=i[l].toString(n);return c}var c=t("big.js"),f=t("random.js").randomInt,h="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";Base62={encode:function(t){var e=t;t=t.toString();try{c(t)}catch(n){console.log("Big init error on ",e,t)}var r=c(t),i="";if("0"==t)return"0";for(;r.gt(0);)i=h[r.mod(62).toFixed()]+i,r=c(r.div(62).toFixed(2).split(".")[0]);return i},decode:function(t){t=t.toString();var e=c(0),n=c(62),r=t.split("").reverse();return r.forEach(function(t,r){e=e.plus(n.pow(r).times(h.indexOf(t)))}),e.toFixed()},encodeHex:function(t){return Base62.encode(s(t.toString()))},decodeHex:function(t){return i(Base62.decode(t))},token:function(){return r()+r()+r()+r()+r()}},n=e.exports=Base62},{"big.js":1,"random.js":2}]},{},[3])(3)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"big.js":6,"random.js":7}],6:[function(e,n,r){!function(e){"use strict";function r(){function t(e){var n=this;return n instanceof t?(e instanceof t?(n.s=e.s,n.e=e.e,n.c=e.c.slice()):s(n,e),void(n.constructor=t)):void 0===e?r():new t(e)}return t.prototype=g,t.DP=l,t.RM=c,t}function i(t,e,n){var r=t.constructor,i=e-(t=new r(t)).e,s=t.c;for(s.length>++e&&o(t,i,r.RM),s[0]?n?i=e:(s=t.c,i=t.e+i+1):++i;s.length<i;s.push(0));return i=t.e,1===n||n&&(i>=e||d>=i)?(t.s<0&&s[0]?"-":"")+(s.length>1?s[0]+"."+s.join("").slice(1):s[0])+(0>i?"e":"e+")+i:t.toString()}function s(t,e){var n,r,i;for(0===e&&0>1/e?e="-0":m.test(e+="")||u(NaN),t.s="-"==e.charAt(0)?(e=e.slice(1),-1):1,(n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(0>n&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):0>n&&(n=e.length),r=0;"0"==e.charAt(r);r++);if(r==(i=e.length))t.c=[t.e=0];else{for(;"0"==e.charAt(--i););for(t.e=n-r-1,t.c=[],n=0;i>=r;t.c[n++]=+e.charAt(r++));}return t}function o(t,e,n,r){var i,s=t.c,o=t.e+e+1;if(1===n?r=s[o]>=5:2===n?r=s[o]>5||5==s[o]&&(r||0>o||s[o+1]!==i||1&s[o-1]):3===n?r=r||s[o]!==i||0>o:(r=!1,0!==n&&u("!Big.RM!")),1>o||!s[0])r?(t.e=-e,t.c=[1]):t.c=[t.e=0];else{if(s.length=o--,r)for(;++s[o]>9;)s[o]=0,o--||(++t.e,s.unshift(1));for(o=s.length;!s[--o];s.pop());}return t}function u(t){var e=new Error(t);throw e.name="BigError",e}var a,l=20,c=1,f=1e6,h=1e6,d=-7,p=21,g={},m=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;g.abs=function(){var t=new this.constructor(this);return t.s=1,t},g.cmp=function(t){var e,n=this,r=n.c,i=(t=new n.constructor(t)).c,s=n.s,o=t.s,u=n.e,a=t.e;if(!r[0]||!i[0])return r[0]?s:i[0]?-o:0;if(s!=o)return s;if(e=0>s,u!=a)return u>a^e?1:-1;for(s=-1,o=(u=r.length)<(a=i.length)?u:a;++s<o;)if(r[s]!=i[s])return r[s]>i[s]^e?1:-1;return u==a?0:u>a^e?1:-1},g.div=function(t){var e=this,n=e.constructor,r=e.c,i=(t=new n(t)).c,s=e.s==t.s?1:-1,a=n.DP;if((a!==~~a||0>a||a>f)&&u("!Big.DP!"),!r[0]||!i[0])return r[0]==i[0]&&u(NaN),i[0]||u(s/0),new n(0*s);var l,c,h,d,p,g,m=i.slice(),v=l=i.length,y=r.length,b=r.slice(0,l),w=b.length,x=t,$=x.c=[],_=0,S=a+(x.e=e.e-t.e)+1;for(x.s=s,s=0>S?0:S,m.unshift(0);w++<l;b.push(0));do{for(h=0;10>h;h++){if(l!=(w=b.length))d=l>w?1:-1;else for(p=-1,d=0;++p<l;)if(i[p]!=b[p]){d=i[p]>b[p]?1:-1;break}if(!(0>d))break;for(c=w==l?i:m;w;){if(b[--w]<c[w]){for(p=w;p&&!b[--p];b[p]=9);--b[p],b[w]+=10}b[w]-=c[w]}for(;!b[0];b.shift());}$[_++]=d?h:++h,b[0]&&d?b[w]=r[v]||0:b=[r[v]]}while((v++<y||b[0]!==g)&&s--);return $[0]||1==_||($.shift(),x.e--),_>S&&o(x,a,n.RM,b[0]!==g),x},g.eq=function(t){return!this.cmp(t)},g.gt=function(t){return this.cmp(t)>0},g.gte=function(t){return this.cmp(t)>-1},g.lt=function(t){return this.cmp(t)<0},g.lte=function(t){return this.cmp(t)<1},g.sub=g.minus=function(t){var e,n,r,i,s=this,o=s.constructor,u=s.s,a=(t=new o(t)).s;if(u!=a)return t.s=-a,s.plus(t);var l=s.c.slice(),c=s.e,f=t.c,h=t.e;if(!l[0]||!f[0])return f[0]?(t.s=-a,t):new o(l[0]?s:0);if(u=c-h){for((i=0>u)?(u=-u,r=l):(h=c,r=f),r.reverse(),a=u;a--;r.push(0));r.reverse()}else for(n=((i=l.length<f.length)?l:f).length,u=a=0;n>a;a++)if(l[a]!=f[a]){i=l[a]<f[a];break}if(i&&(r=l,l=f,f=r,t.s=-t.s),(a=(n=f.length)-(e=l.length))>0)for(;a--;l[e++]=0);for(a=e;n>u;){if(l[--n]<f[n]){for(e=n;e&&!l[--e];l[e]=9);--l[e],l[n]+=10}l[n]-=f[n]}for(;0===l[--a];l.pop());for(;0===l[0];)l.shift(),--h;return l[0]||(t.s=1,l=[h=0]),t.c=l,t.e=h,t},g.mod=function(t){var e,n=this,r=n.constructor,i=n.s,s=(t=new r(t)).s;return t.c[0]||u(NaN),n.s=t.s=1,e=1==t.cmp(n),n.s=i,t.s=s,e?new r(n):(i=r.DP,s=r.RM,r.DP=r.RM=0,n=n.div(t),r.DP=i,r.RM=s,this.minus(n.times(t)))},g.add=g.plus=function(t){var e,n=this,r=n.constructor,i=n.s,s=(t=new r(t)).s;if(i!=s)return t.s=-s,n.minus(t);var o=n.e,u=n.c,a=t.e,l=t.c;if(!u[0]||!l[0])return l[0]?t:new r(u[0]?n:0*i);if(u=u.slice(),i=o-a){for(i>0?(a=o,e=l):(i=-i,e=u),e.reverse();i--;e.push(0));e.reverse()}for(u.length-l.length<0&&(e=l,l=u,u=e),i=l.length,s=0;i;)s=(u[--i]=u[i]+l[i]+s)/10|0,u[i]%=10;for(s&&(u.unshift(s),++a),i=u.length;0===u[--i];u.pop());return t.c=u,t.e=a,t},g.pow=function(t){var e=this,n=new e.constructor(1),r=n,i=0>t;for((t!==~~t||-h>t||t>h)&&u("!pow!"),t=i?-t:t;1&t&&(r=r.times(e)),t>>=1,t;)e=e.times(e);return i?n.div(r):r},g.round=function(t,e){var n=this,r=n.constructor;return null==t?t=0:(t!==~~t||0>t||t>f)&&u("!round!"),o(n=new r(n),t,null==e?r.RM:e),n},g.sqrt=function(){var t,e,n,r=this,i=r.constructor,s=r.c,a=r.s,l=r.e,c=new i("0.5");if(!s[0])return new i(r);0>a&&u(NaN),a=Math.sqrt(r.toString()),0===a||a===1/0?(t=s.join(""),t.length+l&1||(t+="0"),e=new i(Math.sqrt(t).toString()),e.e=((l+1)/2|0)-(0>l||1&l)):e=new i(a.toString()),a=e.e+(i.DP+=4);do n=e,e=c.times(n.plus(r.div(n)));while(n.c.slice(0,a).join("")!==e.c.slice(0,a).join(""));return o(e,i.DP-=4,i.RM),e},g.mul=g.times=function(t){var e,n=this,r=n.constructor,i=n.c,s=(t=new r(t)).c,o=i.length,u=s.length,a=n.e,l=t.e;if(t.s=n.s==t.s?1:-1,!i[0]||!s[0])return new r(0*t.s);for(t.e=a+l,u>o&&(e=i,i=s,s=e,l=o,o=u,u=l),e=new Array(l=o+u);l--;e[l]=0);for(a=u;a--;){for(u=0,l=o+a;l>a;)u=e[l]+s[a]*i[l-a-1]+u,e[l--]=u%10,u=u/10|0;e[l]=(e[l]+u)%10}for(u&&++t.e,e[0]||e.shift(),a=e.length;!e[--a];e.pop());return t.c=e,t},g.toString=g.valueOf=g.toJSON=function(){var t=this,e=t.e,n=t.c.join(""),r=n.length;if(d>=e||e>=p)n=n.charAt(0)+(r>1?"."+n.slice(1):"")+(0>e?"e":"e+")+e;else if(0>e){for(;++e;n="0"+n);n="0."+n}else if(e>0)if(++e>r)for(e-=r;e--;n+="0");else r>e&&(n=n.slice(0,e)+"."+n.slice(e));else r>1&&(n=n.charAt(0)+"."+n.slice(1));return t.s<0&&t.c[0]?"-"+n:n},g.toExponential=function(t){return null==t?t=this.c.length-1:(t!==~~t||0>t||t>f)&&u("!toExp!"),i(this,t,1)},g.toFixed=function(t){var e,n=this,r=d,s=p;return d=-(p=1/0),null==t?e=n.toString():t===~~t&&t>=0&&f>=t&&(e=i(n,n.e+t),n.s<0&&n.c[0]&&e.indexOf("-")<0&&(e="-"+e)),d=r,p=s,e||u("!toFix!"),e},g.toPrecision=function(t){return null==t?this.toString():((t!==~~t||1>t||t>f)&&u("!toPre!"),i(this,t-1,2))},a=r(),"function"==typeof t&&t.amd?t(function(){return a}):"undefined"!=typeof n&&n.exports?n.exports=a:e.Big=a}(this)},{}],7:[function(t,e,n){randomInt=function(t){if((void 0===t||null===t)&&(t={}),(void 0===t.min||null===t)&&(t.min=0),(void 0===t.max||null===t)&&(t.max=4294967295),t.min>t.max){var e=t.min;t.min=t.max,t.max=e}return Math.floor(Math.random()*(t.max-t.min)+t.min)},randomFloat=function(t){return(void 0===t||null===t)&&(t={}),(void 0===t.min||null===t)&&(t.min=0),(void 0===t.max||null===t)&&(t.max=1),Math.random()*(t.max-t.min)+t.min},randomString=function(t){(void 0===t||null===t)&&(t={}),(void 0===t.length||null===t.length)&&(t.length=20),(void 0===t.set||null===t.set)&&(t.set="alphanum");var e;switch(t.set){case"alpha":e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";break;case"alphanum":e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";break;case"num":e="0123456789";break;case"hex":e="0123456789ABCDEF";break;case"custom":if(void 0===t.custom||null===t.custom)return console.error("can't generate a random string with custom set of characters if options.custom is null or undefined"),"";e=t.custom}for(var n="",r=0;r<t.length;r++){var i=randomInt({min:0,max:e.length});n+=e[i]}return n},e.exports.randomInt=randomInt,e.exports.randomFloat=randomFloat,e.exports.randomString=randomString},{}],8:[function(t,e,n){var r,i=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===s.call(t)},u=function(t){"use strict";if(!t||"[object Object]"!==s.call(t))return!1;var e=i.call(t,"constructor"),n=t.constructor&&t.constructor.prototype&&i.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!n)return!1;var o;for(o in t);return o===r||i.call(t,o)};e.exports=function a(){"use strict";var t,e,n,i,s,l,c=arguments[0],f=1,h=arguments.length,d=!1;for("boolean"==typeof c?(d=c,c=arguments[1]||{},f=2):("object"!=typeof c&&"function"!=typeof c||null==c)&&(c={});h>f;++f)if(t=arguments[f],null!=t)for(e in t)n=c[e],i=t[e],c!==i&&(d&&i&&(u(i)||(s=o(i)))?(s?(s=!1,l=n&&o(n)?n:[]):l=n&&u(n)?n:{},c[e]=a(d,l,i)):i!==r&&(c[e]=i));return c}},{}],9:[function(t,e,n){e.exports=function(t){t.plural(/$/,"s"),t.plural(/s$/i,"s"),t.plural(/(ax|test)is$/i,"$1es"),t.plural(/(octop|vir)us$/i,"$1i"),t.plural(/(octop|vir)i$/i,"$1i"),t.plural(/(alias|status)$/i,"$1es"),t.plural(/(bu)s$/i,"$1ses"),t.plural(/(buffal|tomat)o$/i,"$1oes"),t.plural(/([ti])um$/i,"$1a"),t.plural(/([ti])a$/i,"$1a"),t.plural(/sis$/i,"ses"),t.plural(/(?:([^f])fe|([lr])f)$/i,"$1ves"),t.plural(/(hive)$/i,"$1s"),t.plural(/([^aeiouy]|qu)y$/i,"$1ies"),t.plural(/(x|ch|ss|sh)$/i,"$1es"),t.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),t.plural(/([m|l])ouse$/i,"$1ice"),t.plural(/([m|l])ice$/i,"$1ice"),t.plural(/^(ox)$/i,"$1en"),t.plural(/^(oxen)$/i,"$1"),t.plural(/(quiz)$/i,"$1zes"),t.singular(/s$/i,""),t.singular(/(n)ews$/i,"$1ews"),t.singular(/([ti])a$/i,"$1um"),t.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1sis"),t.singular(/(^analy)ses$/i,"$1sis"),t.singular(/([^f])ves$/i,"$1fe"),t.singular(/(hive)s$/i,"$1"),t.singular(/(tive)s$/i,"$1"),t.singular(/([lr])ves$/i,"$1f"),t.singular(/([^aeiouy]|qu)ies$/i,"$1y"),t.singular(/(s)eries$/i,"$1eries"),t.singular(/(m)ovies$/i,"$1ovie"),t.singular(/(x|ch|ss|sh)es$/i,"$1"),t.singular(/([m|l])ice$/i,"$1ouse"),t.singular(/(bus)es$/i,"$1"),t.singular(/(o)es$/i,"$1"),t.singular(/(shoe)s$/i,"$1"),t.singular(/(cris|ax|test)es$/i,"$1is"),t.singular(/(octop|vir)i$/i,"$1us"),t.singular(/(alias|status)es$/i,"$1"),t.singular(/^(ox)en/i,"$1"),t.singular(/(vert|ind)ices$/i,"$1ex"),t.singular(/(matr)ices$/i,"$1ix"),t.singular(/(quiz)zes$/i,"$1"),t.singular(/(database)s$/i,"$1"),t.irregular("child","children"),t.irregular("person","people"),t.irregular("man","men"),t.irregular("child","children"),t.irregular("sex","sexes"),t.irregular("move","moves"),t.irregular("cow","kine"),t.irregular("zombie","zombies"),t.uncountable(["equipment","information","rice","money","species","series","fish","sheep","jeans"])}},{}],10:[function(t,e,n){e.exports=function(e){var n=t("./methods");return e&&t("./native")(n),n}},{"./methods":12,"./native":13}],11:[function(t,e,n){var r=t("./util"),i=function(){return this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[],t("./defaults")(this),this};i.prototype.plural=function(t,e){"string"==typeof t&&(this.uncountables=r.array.del(this.uncountables,t)),this.uncountables=r.array.del(this.uncountables,e),this.plurals.unshift([t,e])},i.prototype.singular=function(t,e){"string"==typeof t&&(this.uncountables=r.array.del(this.uncountables,t)),this.uncountables=r.array.del(this.uncountables,e),this.singulars.unshift([t,e])},i.prototype.irregular=function(t,e){this.uncountables=r.array.del(this.uncountables,t),this.uncountables=r.array.del(this.uncountables,e),t[0].toUpperCase()==e[0].toUpperCase()?(this.plural(new RegExp("("+t[0]+")"+t.slice(1)+"$","i"),"$1"+e.slice(1)),this.plural(new RegExp("("+e[0]+")"+e.slice(1)+"$","i"),"$1"+e.slice(1)),this.singular(new RegExp("("+e[0]+")"+e.slice(1)+"$","i"),"$1"+t.slice(1))):(this.plural(new RegExp(""+t[0].toUpperCase()+t.slice(1)+"$"),e[0].toUpperCase()+e.slice(1)),this.plural(new RegExp(""+t[0].toLowerCase()+t.slice(1)+"$"),e[0].toLowerCase()+e.slice(1)),this.plural(new RegExp(""+e[0].toUpperCase()+e.slice(1)+"$"),e[0].toUpperCase()+e.slice(1)),this.plural(new RegExp(""+e[0].toLowerCase()+e.slice(1)+"$"),e[0].toLowerCase()+e.slice(1)),this.singular(new RegExp(""+e[0].toUpperCase()+e.slice(1)+"$"),t[0].toUpperCase()+t.slice(1)),this.singular(new RegExp(""+e[0].toLowerCase()+e.slice(1)+"$"),t[0].toLowerCase()+t.slice(1)))},i.prototype.human=function(t,e){this.humans.unshift([t,e])},i.prototype.uncountable=function(t){this.uncountables=this.uncountables.concat(t)},i.prototype.clear=function(t){switch(null==t&&(t="all"),t){case"all":this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[];default:this[t]=[]}},i.prototype["default"]=function(){return this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[],t("./defaults")(this),this},e.exports=new i},{"./defaults":9,"./util":14}],12:[function(t,e,n){var r=t("./util"),i=e.exports;i.inflections=t("./inflections"),i.inflect=function(t){t(i.inflections)},i.camelize=function(t,e){var n;return null==e&&(e=!0),n=r.string.gsub(t,/\/(.?)/,function(t){return"."+r.string.upcase(t[1])}),n=r.string.gsub(n,/(?:_)(.)/,function(t){return r.string.upcase(t[1])}),e?r.string.upcase(n):r.string.downcase(n)},i.underscore=function(t){var e;return e=r.string.gsub(t,/\./,"/"),e=r.string.gsub(e,/([A-Z]+)([A-Z][a-z])/,"$1_$2"),e=r.string.gsub(e,/([a-z\d])([A-Z])/,"$1_$2"),e=r.string.gsub(e,/-/,"_"),e.toLowerCase()},i.dasherize=function(t){return r.string.gsub(t,/_/,"-")},i.demodulize=function(t){return r.string.gsub(t,/^.*\./,"")},i.foreign_key=function(t,e){return null==e&&(e=!0),i.underscore(i.demodulize(t))+(e?"_id":"id")},i.ordinalize=function(t){var e;if(t=parseInt(t),11===(e=Math.abs(t)%100)||12===e||13===e)return""+t+"th";switch(Math.abs(t)%10){case 1:return""+t+"st";case 2:return""+t+"nd";case 3:return""+t+"rd";default:return""+t+"th"}},i.uncountability=function(t){return i.inflections.uncountables.some(function(e,n,r){return null!=t.match(new RegExp("(\\b|_)"+e+"$","i"))})},i.pluralize=function(t){var e,n;if(n=t,""===t||i.uncountability(t))return n;for(var s=0;s<i.inflections.plurals.length&&(e=i.inflections.plurals[s],n=r.string.gsub(n,e[0],e[1]),null==t.match(e[0]));s++);return n},i.singularize=function(t){var e,n;if(e=t,""===t||i.uncountability(t))return e;for(var s=0;s<i.inflections.singulars.length&&(n=i.inflections.singulars[s],e=r.string.gsub(e,n[0],n[1]),!t.match(n[0]));s++);return e},i.humanize=function(t){var e,n;n=t;for(var s=0;s<i.inflections.humans.length;s++)e=i.inflections.humans[s],n=r.string.gsub(n,e[0],e[1]);return n=r.string.gsub(n,/_id$/,""),n=r.string.gsub(n,/_/," "),r.string.capitalize(n,!0)},i.titleize=function(t){var e;return e=i.humanize(i.underscore(t)),e=r.string.gsub(e,/[^a-zA-Z:']/," "),r.string.capitalize(e)},i.tableize=function(t){return i.pluralize(i.underscore(t))},i.classify=function(t){return i.camelize(i.singularize(r.string.gsub(t,/.*\./,"")))}},{"./inflections":11,"./util":14}],13:[function(t,e,n){e.exports=function(t){var e=function(t,e){String.prototype.__defineGetter__(t,e)},n=["__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","charAt","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","charCodeAt","indexOf","lastIndexof","length","localeCompare","match","replace","search","slice","split","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimLeft","trimRight","gsub"];Object.keys(t).forEach(function(r){"inflect"!=r&&"inflections"!=r&&(-1!==n.indexOf(r)?console.log("warn: You should not override String.prototype."+r):e(r,function(){return t[r](this)}))})}},{}],14:[function(t,e,n){var r=e.exports={array:{del:function(t,e){var n=t.indexOf(e);return-1!=n?0==n?t.slice(1):t.slice(0,n).concat(t.slice(n+1)):t},first:function(t){return t[0]},last:function(t){return t[t.length-1]}},string:{gsub:function(t,e,n){var i,s,o,u,a,l,c;if(null==e||null==n)return r.string.value(t);for(l="",c=t;c.length>0;)if(s=c.match(e)){if(l+=c.slice(0,s.index),"function"==typeof n)s[1]=s[1]||s[0],l+=n(s);else if(n.match(/\$[1-9]/)){for(u=s,o=r.array.del(s,void 0);o!==u;)u=o,o=r.array.del(o,void 0);for(s[1]=s[1]||s[0],a=n,i=1;9>=i;i++)o[i]&&(a=r.string.gsub(a,new RegExp("\\$"+i),o[i]));l+=a}else l+=n;c=c.slice(s.index+s[0].length)}else l+=c,c="";return l},upcase:function(t){var e=r.string.gsub(t,/_([a-z])/,function(t){return"_"+t[1].toUpperCase()});return e=r.string.gsub(e,/\/([a-z])/,function(t){return"/"+t[1].toUpperCase()}),e[0].toUpperCase()+e.substr(1)},capitalize:function(t,e){var n=t.toLowerCase();return e||(n=r.string.gsub(n,/\s([a-z])/,function(t){return" "+t[1].toUpperCase()})),n[0].toUpperCase()+n.substr(1)},downcase:function(t){var e=r.string.gsub(t,/_([A-Z])/,function(t){return"_"+t[1].toLowerCase()});return e=r.string.gsub(e,/\/([A-Z])/,function(t){return"/"+t[1].toLowerCase()}),e[0].toLowerCase()+e.substr(1)},value:function(t){return t.substr(0)}}}},{}],15:[function(e,n,r){(function(i){!function(e){if("object"==typeof r&&"undefined"!=typeof n)n.exports=e();else if("function"==typeof t&&t.amd)t([],e);else{var s;s="undefined"!=typeof window?window:"undefined"!=typeof i?i:"undefined"!=typeof self?self:this,s.progenitor=e()}}(function(){return function t(n,r,i){function s(u,a){if(!r[u]){if(!n[u]){var l="function"==typeof e&&e;if(!a&&l)return l(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[u]={exports:{}};n[u][0].call(f.exports,function(t){var e=n[u][1][t];return s(e?e:t)},f,f.exports,t,n,r,i)}return r[u].exports}for(var o="function"==typeof e&&e,u=0;u<i.length;u++)s(i[u]);return s}({1:[function(t,e,n){var r,i=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===s.call(t)},u=function(t){"use strict";if(!t||"[object Object]"!==s.call(t))return!1;var e=i.call(t,"constructor"),n=t.constructor&&t.constructor.prototype&&i.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!n)return!1;var o;for(o in t);return o===r||i.call(t,o)};e.exports=function a(){"use strict";var t,e,n,i,s,l,c=arguments[0],f=1,h=arguments.length,d=!1;for("boolean"==typeof c?(d=c,c=arguments[1]||{},f=2):("object"!=typeof c&&"function"!=typeof c||null==c)&&(c={});h>f;++f)if(t=arguments[f],null!=t)for(e in t)n=c[e],i=t[e],c!==i&&(d&&i&&(u(i)||(s=o(i)))?(s?(s=!1,l=n&&o(n)?n:[]):l=n&&u(n)?n:{},c[e]=a(d,l,i)):i!==r&&(c[e]=i));return c}},{}],2:[function(t,e,n){var r=function(){},i=t("extend"),s={},o=function(t){
return t.classMethods||(t.classMethods={}),t.classMethods.inherited||(t.classMethods.inherited=r),t.instanceMethods||(t.instanceMethods={}),t.instanceMethods.init||(t.instanceMethods.init=r),function(e,n,u){var a;if(a=s[e])return a;n=("function"==typeof n?n():n)||{},u=("function"==typeof u?u():u)||{},u.classMethods||(u.classMethods={}),a=function(e){"prototype-definition"!==e&&(t.instanceMethods.init.apply(this,arguments),p.init.apply(this,arguments))};var l=function(e){return t.classMethods[e]&&t.classMethods[e].apply(this,Array.prototype.slice.call(arguments,1))},c={"class":t,className:e,"super":l,progeny:o(a)},f=i({},t.classMethods,c,u.classMethods);i(a,a.classMethods=f);var h=function(e){return t.instanceMethods[e]&&t.instanceMethods[e].apply(this,Array.prototype.slice.call(arguments,1))},d={constructor:t,"class":a,className:e,"super":h,init:r},p=i({},t.instanceMethods,d,n);return a.prototype=new t("prototype-definition"),i(a.prototype,a.instanceMethods=p),t.classMethods.inherited.apply(t,[a]),s[e]=a}};n=e.exports=function(){Object.progeny||(Object.progeny=o(Object)),Error.progeny||(Error.progeny=o(Error))}},{extend:1}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{extend:8}],16:[function(t,e,n){function r(t){var e=t.id||t._id;this.persisted=!1,e?l.ids.isValid(e)?this.id=l.ids.next(e):"ObjectID"===e._bsontype?this.id=e:this.id=e.toString():null===e?this.id=null:this.id=l.ids.next(),this._data=u({_id:this.id},s(t,["id","_id"])),this._changes={}}function i(t){var e=new this({_id:null});return this.adapter[t].call(this.adapter,function(t){t=e["class"].shortToLong(t),e.kept(t)}),e}function s(t,e){var n={};for(var r in t)-1==e.indexOf(r)&&(n[r]=t[r]);return n}function o(t,e){if(!e||"object"!=typeof e)return e;var n={};return Object.keys(e).forEach(function(r){n[t[r]||r]=e[r]}),n}t("progenitor.js")();var u=t("extend"),a=t("i")(),l=t("./memory_adapter"),c=function(){};Document=Object.progeny("Document",{init:function(t,e){r.call(this,t),this.relation=e,this.RSVP={success:c,error:c},this.loaded=!1},isValid:function(){var t,e,n=!0,r=this["class"].validate||{},i=r.presence||[],s=r.format||{},o=Object.keys(s),u=r.custom||[];for(t=0;t<i.length;++t)if(!this.get(i[t])){n=!1;break}if(!n)return!1;for(t=0;t<o.length;++t)if(e=o[t],!s[e].test(this.get(e))){n=!1;break}for(t=0;t<u.length;++t)if(!u[t].call(this)){n=!1;break}return n},get:function(t){if("id"==t)return this.id;if(this["class"].belongsTo.indexOf(t)>=0){var e=this.get(a.foreign_key(t));return e&&Document[a.classify(t)].find(e)}return this["class"].namedFields[t]?this._data[t]||null:void 0},set:function(){var t,e,n,r=arguments[0],i=2==arguments.length,s={};if(arguments[0]){i&&(r={},r[arguments[0]]=arguments[1]);for(t in r){var o=this["class"].belongsTo.indexOf(t)>=0;if(o){var u=a.foreign_key(t);r[u]=r[t].id,t=u}(o||this["class"].namedFields[t])&&((e=this.get(t))!=(n=r[t])&&(this._changes[t]=[e,n]),"_id"===t&&(this.id=n),this._data[t]=s[t]=n)}return i?s[arguments[0]]:s}},changedAttributes:function(){return u({},this._changes)},save:function(){var t=this,e={},n=!this.isValid(),r=!Object.keys(this.changedAttributes()).length;return n||r&&this.persisted?(this.loaded=!0,this):(this.loaded=!1,this.relation=new Document.Relation(this["class"],this),this.persisted?(Object.keys(this._changes).forEach(function(n){e[n]=t.get(n)}),this.relation.update(e)):((this["class"].beforeCreate||[]).forEach(function(e){e.call(t)}),this.relation.create(u({},this._data))))},update:function(){return this.set.apply(this,arguments),this.save()},destroy:function(){var t=this;return this.loaded=!1,this["class"].adapter.remove({_id:this.id},function(e){t.loaded=!0,t.kept(t.isDestroyed=!!e)}),this},kept:function(t){this.set(t),this.loaded=!0,(this.RSVP.wasKept=!!t)?(this._changes={},this.persisted=!0,this.RSVP.success(this)):this.RSVP.error()},then:function(t,e){this.RSVP.success=t||c,this.RSVP.error=e||c,this.loaded&&(this.RSVP.wasKept?this.RSVP.success(this):this.RSVP.error())},asJSON:function(){for(var t,e={id:this.id.toString(),createdAt:this.get("createdAt"),updatedAt:this.get("updatedAt")},n=0;n<this["class"].allow.length;++n)if(t=this["class"].allow[n],/(.+)_id$/.test(t)){var r=this.get(t);e[t.slice(0,-3)]={id:r?r.toString():r}}else e[t]=this.get(t);return e}},{classMethods:{namedFields:null,shortFields:null,defaultFields:{ObjectID:{_id:"_id"},Date:{createdAt:"cT",updatedAt:"uT"}},inherited:function(t){var e;this[t.className]=t,t.fields||(t.fields={}),t.belongsTo||(t.belongsTo=[]),t.adapter=new l(t),t.fields.ObjectID=u({},this.defaultFields.ObjectID,t.fields.ObjectID),t.fields.Date=u({},this.defaultFields.Date,t.fields.Date),t.namedFields={},t.shortFields={},t.belongsTo.forEach(function(e){t.fields.ObjectID[a.foreign_key(e)]=e.slice(0,1)+"_id"});for(var n in t.fields)for(var r in e=t.fields[n])t.namedFields[r]=e[r],t.shortFields[e[r]]=r},find:function(t){var e;if(!t||"string"!=typeof t&&"ObjectID"!==t._bsontype)return new Document.Relation(this).find(t);this.loaded=!1,t=l.ids.isValid(t)?l.ids.next(t):t;var n=new Document.Relation(this,e=new this({_id:t}));return(e.relation=n).find()},count:function(){return new Document.Relation(this).count()},first:function(){return i.call(this,"first")},last:function(){return i.call(this,"last")},shortToLong:function(t){return o.call(this,this.shortFields,t)},longToShort:function(t){return o.call(this,this.namedFields,t)}}}),u(Document,{Relation:t("./relation"),Count:t("./count"),Adapter:l}),n=e.exports=Document},{"./count":2,"./memory_adapter":3,"./relation":4,extend:8,i:10,"progenitor.js":15}]},{},[16])(16)});